app.controller("AboutMeCtrl",["$scope","$http","$window","CustomModalService",function(n,t,i,r){n.loading=!0;t.post("/AboutMe/Init").then(function(t){var i=t.data;$.extend(n,i);n.loading=null});n.joinAgent=function(){r.confirm("确定要加盟股东?").then(function(n){n&&t.post("/AboutMe/JoinAgent").then(function(n){var t=n.data;if(!t.IsSuccess){r.alertError(t.ErrorMessage);return}r.alert("成功加盟股东").then(function(){i.location.reload()})})})}}]);app.controller("AboutMeUpdateMemberInfoCtrl",["$scope","$http","$window","$timeout","CustomModalService",function(n,t,i,r,u){t.post("/AboutMe/UpdateMemberInfoInit").then(function(t){var i=t.data;n.params=i.member;i.member.birthday&&r(function(){$("#birthday").datepicker("setValue",i.member.birthday)})});n.updateMemberInfoSubmit=function(r){n.isProcessing=!0;t.post("/AboutMe/UpdateMemberInfoSubmit",r).then(function(t){var r=t.data;n.isProcessing=null;r.IsSuccess?u.alert("您的基本资料已变更成功").then(function(){i.location.href="/AboutMe"}):u.alertError(r.ErrorMessage)})};n.help=null;n.showHelp=function(t){n.help=t};n.hideHelp=function(){n.help=null}}]);app.controller("AccountCaptchaDialogCtrl",["$http","$scope","$interval","$modalInstance","$rootScope","captchaId","identityId",function(n,t,i,r,u,f,e){function o(){initNECaptcha({captchaId:f,element:"#captcha-instance",mode:"embed",onVerify:function(n,i){n||(t.processing=!0,u.$broadcast("validateNECaptcha"+e,i.validate))}},function(){t.loading=!1},function(i){t.loading=!1;t.initFail=!0;n.post("/Home/InitNeCaptchaError",{error:i})})}t.loading=!0;t.processing=!1;var s=i(function(){typeof initNECaptcha=="function"&&(o(),i.cancel(s))},100);t.dismiss=function(){r.dismiss("cancel")};t.reInit=function(){t.loading=!0;t.processing=!1;t.initFail=!1;o()};t.$on("reInitNECaptcha"+e,function(){t.reInit()});t.$on("closeCaptchaModal"+e,function(){r.close("close")})}]);app.controller("AccountChangeMoneyPasswordCtrl",["$scope","$http","$window","CustomModalService",function(n,t,i,r){function u(){t.post("/Account/CheckMoneyPassword").then(function(t){var i=t.data;if(n.loading=!1,n.isSuccess=i.IsSuccess,i.IsSuccess===!1){n.errorMsg=i.ErrorMessage;return}n.showInitSetting=i.NoSetMoneyPassword})}n.params={};n.loading=!0;u();n.setPassword=function(u,f){if(u.newPassword!==f){n.notConfirm=!0;return}u.IsCreate=!0;n.notConfirm=!1;n.isProcessing=!0;t.post("/Account/ChangeMoneyPasswordSubmit",u).then(function(t){var u=t.data;n.isProcessing=!1;u.IsSuccess?r.alert("您的取款密码已设置成功").then(function(){i.location.href="/"}):r.alertError(u.ErrorMessage)})};n.change=function(u,f){if(n.same=!1,n.notConfirm=!1,u.oldPassword==u.newPassword){n.same=!0;return}if(u.newPassword!=f){n.notConfirm=!0;return}n.isProcessing=!0;t.post("/Account/ChangeMoneyPasswordSubmit",u).then(function(t){var u=t.data;n.isProcessing=null;u.IsSuccess?r.alert("您的取款密码已变更成功").then(function(){i.location.href="/"}):r.alertError(u.ErrorMessage)})};n.cancel=function(){i.location.href="/"}}]);app.controller("AccountChangePasswordCtrl",["$scope","$window","$http","CustomModalService","labelService",function(n,t,i,r,u){function e(){i.post("/Account/GetChangePasswordPageStatus",null).then(function(t){var u=t.data,i;if(u.IsSuccess===!1){r.alertError(u.ErrorMessage);return}if(u.Status!==0)for(i=0;i<f.length;i++)f[i].status===u.Status&&(n.langs.ChangePwdTip=f[i].tip)})}var f=[{status:1,tip:u.get("Account.ForceChangePwdTip")},{status:2,tip:u.get("Account.PasswordWeakTip")}];n.langs={ChangePwdTip:""};n.params={};e();n.change=function(u){n.same=!1;n.formatError=!1;n.notConfirm=!1;var f=new RegExp("^(?=.*[a-zA-Z])(?=.*[0-9]).{6,}$").test(n.params.newPassword);if(n.params.oldPassword==n.params.newPassword){n.same=!0;return}if(!f){n.formatError=!0;return}if(n.params.newPassword!=n.confirm){n.notConfirm=!0;return}n.isProcessing=!0;i.post("/Account/ChangePasswordSubmit",u).then(function(i){var u=i.data;if(n.isProcessing=null,u.IsSuccess===!1){r.alertError(u.ErrorMessage);return}r.alert("您的密码已变更成功，请立即以新密码重新登入").then(function(){if(u.IsSuccess===!0){t.location.href="/Account/SignOut";return}t.location.href="/"})})};n.cancel=function(){t.location.href="/"}}]);app.controller("AccountCtrl",["$scope","$http","$rootScope","DataService","signalrService",function(n,t,i,r,u){n.signOut=function(){n.isProcessing=!0};n.updateBalance=function(){n.updatingBalance||(n.updatingBalance=!0,t.post("/Account/GetMyBalance").then(function(t){var r=t.data;n.updatingBalance=null;i.wallets.my=r}))};u.on("updateMyBalance",function(n){i.wallets.my=n});n.callBackAllWallet=function(){n.updatingBalance||(n.updatingBalance=!0,t.post("/Account/CallBackAllWallet").then(function(t){var r=t.data;n.updatingBalance=null;i.wallets.my=r}))}}]);app.controller("ActivityCtrl",["$scope","ActivityService",function(n,t){function r(){var n="<style>body { background: #"+i.backgroundColor+";}#activity { background: url('"+i.backgroundImage+"') no-repeat center top;<\/style>";angular.element(document.body).append(n)}var i={backgroundColor:"0f0620",backgroundImage:"https://cdn.weibo-hk.com/Web.Portal/_Common/Content/Views/Lobby/Activity/board/bg.jpg"};t.getActivity().then(function(t){n.activitys=t.AdCategoryItems;i.backgroundColor=t.ColorCode||i.backgroundColor;i.backgroundImage=t.LobbyImg||i.backgroundImage;r();n.activitys.length>0&&(n.categories=n.activitys[0].Name)});n.categoryClick=function(t){n.categories=t}}]);app.controller("AgentApplyCtrl",["$scope","$http","$window","$modal","labelService","$location","CustomModalService",function(n,t,i,r,u,f,e){n.params={};n.isShowMore=!1;n.isProcessing=!1;n.moreOptionClick=function(){n.isShowMore=!0};n.isValid=!0;n.chineseIsValid=!0;n.numberIsValid=!0;n.numberOrEmailIsValid=!0;n.emailIsValid=!0;t.post("/AgentApply/GetAgentRegisterSetting").then(function(t){n.agentRegisterSetting=t.data});t.post("/AgentApply/GetAllBanks").then(function(t){n.banks=t.data;n.params.GroupBank=null});n.$watch("params.Mobile",function(t,i){if(t){var r=new RegExp("^[0-9]+$").test(t);r||(n.params.Mobile=i)}});n.$watch("params.QQ",function(t,i){if(t){var r=new RegExp("^[0-9]+$").test(t);r||(n.params.QQ=i)}});n.updateBankName=function(){n.isValid=!0;n.chineseIsValid=!0;n.numberIsValid=!0;n.numberOrEmailIsValid=!0;n.emailIsValid=!0;this.params.BankAccount=undefined};n.updateAccount=function(){if(this.params.GroupBank!=null&&this.params.BankAccount!=undefined)switch(this.params.GroupBank.AccountFormat){case 1:if(n.chineseIsValid=new RegExp(/^[^\u4e00-\u9fa5]+$/).test(this.params.BankAccount),n.chineseIsValid)n.chineseIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 2:if(n.numberIsValid=new RegExp(/^[0-9]+$/).test(this.params.BankAccount),n.numberIsValid)n.numberIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 3:if(n.numberOrEmailIsValid=new RegExp(/^[0-9]+$/).test(this.params.BankAccount),n.numberOrEmailIsValid)n.numberOrEmailIsValid=!0,n.isValid=!0;else if(n.numberOrEmailIsValid=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/).test(this.params.BankAccount),n.numberOrEmailIsValid)n.numberOrEmailIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 4:if(n.emailIsValid=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/).test(this.params.BankAccount),n.emailIsValid)n.emailIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}}else n.isValid=!0,n.chineseIsValid=!0,n.numberIsValid=!0,n.numberOrEmailIsValid=!0,n.emailIsValid=!0};n.$watchCollection("[params.GroupBank, params.Province, params.City, params.BankAccount]",function(t,i){var r=$.grep(t,function(i){if(t[0]==null&&i==undefined){n.isBankRequired=!0;return}if(i==""){n.isBankRequired=!0;return}return i!==undefined});switch(r.length){case 0:n.isBankRequired=!1;break;case i.length:n.isBankRequired=!0;break;default:n.isBankRequired=!0}},!0);n.apply=function(){var i=new RegExp("^[A-Za-z][A-Za-z_0-9]{1,14}$").test(n.params.Account);if(!i){e.alert(u.get("Agent.Account_Error")||"代理帐号格式错误");return}if(n.params.Confirm_Password!=n.params.Password){e.alert(u.get("Agent.Different_Password")||"代理密码与确认密码不同");return}if(!n.checkCode){e.alert(u.get("Agent.Empty_Checkcode")||"验证码为空, 请取得验证码");return}if(!n.isValid){$('input[ng-model="params.BankAccount"]').focus();return}n.params.CheckCodeEncrypt=n.checkCode.encrypt;n.isProcessing=!0;n.params.BankName=n.params.GroupBank==null?null:n.params.GroupBank.Name;t.post("/AgentApply/ApplySubmit",n.params).then(function(t){var i=t.data;if(n.isProcessing=!1,i.IsSuccess===!1){e.alertError(i.ErrorMessage).then(function(){n.params.checkCode=null;$("#checkcode-input-group input").focus()});return}n.params=null;r.open({templateUrl:"/AgentApply/AgentDialog",controller:"AgentApplyDialogCtrl",scope:n})})}}]);app.controller("AgentApplyDialogCtrl",["$scope","$window","$modalInstance",function(n,t,i){n.isProcess=!1;n.close=function(){i.close()}}]);app.controller("AnyTimeDiscountConfirmDialogCtrl",["$http","$scope","$filter","$modalInstance","CustomModalService","detail",function(n,t,i,r,u,f){function o(){r.dismiss()}function s(){if(!f.RealReceiveAmount){r.close();return}t.receiving=!0;n.post("/AnyTimeDiscount/ReceiveMemberAnyTimeDiscount",null).then(function(n){var f,e,o;if(t.receiving=!1,f=n.data,f.IsSuccess===!1){u.alertError(f.ErrorMessage);return}e=i("currency");o=e(f.totalAmount);u.alert("已领取 "+o).then(function(){r.close()})})}function h(n,t){var i,r,u,f;try{i=n.toString().split(".")[1].length}catch(e){i=0}try{r=t.toString().split(".")[1].length}catch(e){r=0}return u=Math.pow(10,Math.max(i,r)),f=i>=r?i:r,((n*u-t*u)/u).toFixed(f)}t.detail=f;t.cancel=o;t.ok=s;var e=h(t.detail.MaxWithdraw,t.detail.AlreadyReceivedAmount||0);t.receivingPercentage=f.AlreadyReceivedAmount/f.MaxWithdraw*100;t.remainAmount=e>0?e:0}]);app.controller("AnyTimeDiscountDetailDialogCtrl",["$http","$scope","$filter","$modal","$modalInstance","CustomModalService",function(n,t,i,r,u,f){function s(){u.dismiss()}function e(){t.receiving=!0;n.post("/AnyTimeDiscount/ReceiveMemberAnyTimeDiscount",null).then(function(n){var r,e,o;if(t.receiving=!1,r=n.data,r.IsSuccess===!1){f.alertError(r.ErrorMessage);return}e=i("currency");o=e(r.totalAmount);f.alert("已领取 "+o).then(function(){u.close()})})}function h(){n.post("/AnyTimeDiscount/GetMemberDiscountDetail",null).then(function(n){var i=n.data;if(i.IsSuccess===!1){f.alertError(i.ErrorMessage);return}t.loaded=!0;o(i)})}function c(){t.loaded=!1;n.post("/AnyTimeDiscount/RefreshMemberDiscountDetail",null).then(function(n){var i=n.data;if(i.IsSuccess===!1){f.alertError(i.ErrorMessage);return}t.loaded=!0;o(i)})}function o(n){t.startTime=n.StartDateTime?moment(n.StartDateTime).format("YYYY/MM/DD HH:mm:ss"):null;t.total=n.TotalAmount;t.qualification=n.Qualification;t.detail=[];angular.forEach(n.Detail,function(n){t.detail.push({id:n.GameTypeId,displayName:n.GameTypeDisplayName,betAmount:n.BetAmount,discountAmount:n.DiscountAmount,categoryDisplayName:n.CategoryDisplayName})})}function l(){if(!t.maxWithdraw){e();return}t.receiving=!0;r.open({templateUrl:"/AnyTimeDiscount/ConfirmDialog",controller:"AnyTimeDiscountConfirmDialogCtrl",windowClass:"modal-atdcd",resolve:{detail:function(){return{TotalAmount:t.total,RealReceiveAmount:t.realReceiveAmount,DeductAmount:t.deductAmount,MaxWithdraw:t.maxWithdraw,AlreadyReceivedAmount:t.alreadyReceivedAmount}}}}).result.then(function(){u.close()},function(){t.receiving=!1})}h();t.dismiss=s;t.receive=e;t.refresh=c;t.receiveConfirm=l}]);app.controller("AuthenticaredDeviceCtrl",["$http","$scope","$window","$modal","CustomModalService","labelService","signalrService",function(n,t,i,r,u,f,e){function s(){e.connect();n.post("/Account/GetGpkAuthenticatorDevice",null).then(function(n){var i=n.data;if(i.IsSuccess===!1){u.alertError(i.ErrorMessage);return}t.devices=i.DeviceList||t.devices;t.statusDisabled=i.MemberDisableGpkAuth;t.isEnable=!0});l()}function h(i){!t.isDeleting&&i&&(t.isDeleting=!0,u.promptPwd(f.get("Account.UnbindPrompt")||"请输入登入密码来继续解除绑定").then(function(r){if(!r){t.isDeleting=!1;return}n.post("/Account/DeleteGpkAuthenticatorDevice",{deviceId:i.DeviceId,password:r}).then(function(n){var r=n.data;if(t.isDeleting=!1,r.IsSuccess===!1){u.alertError(r.ErrorMessage);return}u.alert(f.get("Account.UnbindSuccess")||"解除绑定成功").then(function(){for(var r=null,n=0;n<t.devices.length;n++)t.devices[n].DeviceId===i.DeviceId&&(r=n);r!==null&&t.devices.splice(r,1)})})}))}function c(){t.devices.length>=o||t.isBinding||(t.isBinding=!0,n.post("/Account/GetRegisteredGpkAuthenticatorDeviceQr",{signalRId:e.getConnectionId()}).then(function(n){var i=n.data;if(i.IsSuccess===!1){t.isBinding=!1;u.alertError(i.ErrorMessage);return}r.open({templateUrl:"/Account/QrCodeAuthentication",controller:"QrCodeAuthenticationCtrl",windowClass:"modal-qca",resolve:{authInfo:function(){return{AndroidAppUrl:i.GpkAuthenticatorInfo.AndroidAppUrl,AndroidAppQrCode:i.GpkAuthenticatorInfo.AndroidAppQrCode,IosAppUrl:i.GpkAuthenticatorInfo.IosAppUrl,IosAppQrCode:i.GpkAuthenticatorInfo.IosAppQrCode,RegisterUrl:i.GpkAuthenticatorInfo.RegisterUrl,RegisterQrCode:i.GpkAuthenticatorInfo.RegisterQrCode}}}}).result.then(function(){t.isBinding=!1},function(){t.isBinding=!1})}))}function l(){e.on("gpkAuthRegisterDeviceSuccess",function(n){if(!n){u.alertError(f.get("Account.BindFailed")||"绑定失败，请稍后再试。").then(function(){i.location.reload()});return}u.alert(f.get("Account.BindSuccess")||"绑定成功").then(function(){i.location.reload()})})}function a(){t.isSwitching||(t.isSwitching=!0,t.statusDisabled=!t.statusDisabled,n.post("/Account/UpdateMemberGpkAuthDisableState",{disabled:t.statusDisabled}).then(function(n){var i=n.data;if(t.isSwitching=!1,i.IsSuccess===!1){u.alertError(i.ErrorMessage).then(function(){t.statusDisabled=!t.statusDisabled});return}}))}var o=2;t.isEnable=null;t.statusDisabled=null;t.devices=[];t.deleteDevice=h;t.bindDevice=c;t.switchAuth=a;n.post("/Home/GetGpkAuthEnable").then(function(n){var i=n.data;if(!i.Enable){t.isEnable=!1;return}s()})}]);app.controller("BetRecordCtrl",["$scope","$q","$http","$timeout","bodyScrollService","CustomModalService",function(n,t,i,r,u,f){function l(){a();var u=i.post("/BetRecord/GetSupplierCategories",{}),f=i.post("/BetRecord/GetKindCategories",{}),o=[u,f];t.all(o).then(function(t){var i=t[0].data,u=t[1].data;n.betRecord.suppliers=i;n.betRecord.kinds=u;$.each(n.betRecord.suppliers,function(n,t){var i=t.Categories;t.isSelected=!0;$.each(i,function(n,t){t.isSelected=!0})});n.betRecord.status.isReady=!0;r(function(){$(function(){$("#betDialog").dialog({autoOpen:!1,minWidth:800});$("#opener").click(function(){$("#betDialog").dialog("open")})})});e();s()});$(document).on("scroll",function(){r(e)});n.$on("$destroy",h)}function a(){$(function(){var t=$("html").attr("meidon-time");n.betRecord.wagersTimeBegin=n.betRecord.payoffTimeBegin=moment(t,"YYYY/MM/DD 00:00:00").format("YYYY/MM/DD 00:00:00");n.betRecord.wagersTimeEnd=n.betRecord.payoffTimeEnd=moment(t,"YYYY/MM/DD 23:59:59").format("YYYY/MM/DD 23:59:59")})}function e(){var r,u,e,t;if(!o&&!n.betRecord.status.isDataAllLoaded&&(r=$("#bet_record").scrollTop()+$("#bet_record").height(),u=$(document).scrollTop()+$(window).height(),!(r-u>1e3))){if(e=c(),n.betRecord.categoriesString==="(无选取)"){n.isSearchCompleted=!0;n.betRecord.status.isDataAllLoaded=!0;return}t={SearchParams:{WagersTimeBegin:n.betRecord.searchTimeOption==1?n.betRecord.wagersTimeBegin:"",WagersTimeEnd:n.betRecord.searchTimeOption==1?n.betRecord.wagersTimeEnd:"",PayoffTimeBegin:n.betRecord.searchTimeOption==2?n.betRecord.payoffTimeBegin:"",PayoffTimeEnd:n.betRecord.searchTimeOption==2?n.betRecord.payoffTimeEnd:"",SearchTimeOption:n.betRecord.searchTimeOption,GameCategories:e,UnpayOnly:n.betRecord.unpayOnly},take:30,skip:n.betRecord.lists.length};n.betRecord.categoriesString==="(全选)"&&delete t.SearchParams.GameCategories;n.betRecord.status.isLoading=!0;o=i.post("/BetRecord/SearchBetRecord",t).then(function(i){if(n.betRecord.status.isLoading=!1,n.isSearchCompleted=!0,o=null,!i.data.IsSuccess){f.alertError(i.data.ErrorMessage).then(function(){n.betRecord.status.isDataAllLoaded=!0});return}n.betRecord.lists=n.betRecord.lists.concat(i.data.result);i.data.result.length<t.take&&(n.betRecord.status.isDataAllLoaded=!0,h())})}}function s(){var r=c(),t;n.betRecord.categoriesString!=="(无选取)"&&(t={WagersTimeBegin:n.betRecord.wagersTimeBegin,WagersTimeEnd:n.betRecord.wagersTimeEnd,PayoffTimeBegin:n.betRecord.payoffTimeBegin,PayoffTimeEnd:n.betRecord.payoffTimeEnd,SearchTimeOption:n.betRecord.searchTimeOption,GameCategories:r,UnpayOnly:n.betRecord.unpayOnly},n.betRecord.categoriesString==="(全选)"&&delete t.GameCategories,i.post("/BetRecord/GetBetrecordTotalInfo",t).then(function(t){angular.extend(n.total,t.data)}))}function h(){$(document).off("scroll")}function c(){var t=[];return $.each(n.betRecord.suppliers,function(n,i){var r=i.Categories;$.each(r,function(n,i){i.isSelected&&t.push(i.PropertyName)})}),t}n.betRecord={status:{isReady:!1,isLoading:!1,isDataAllLoaded:!1},lists:[],wagersTimeBegin:null,wagersTimeend:null,payoffTimeBegin:null,payoffTimeEnd:null,searchTimeOption:1,unpayOnly:!1,suppliers:[],kinds:[],categoriesString:"(全选)"};n.total={};l();var o;n.betRecord.submit=function(){var t=$(window).scrollTop();n.isSearchCompleted=!1;n.betRecord.lists=[];n.total={};n.betRecord.status.isDataAllLoaded=!1;$(document).on("scroll",function(){r(e)});r(function(){t===$(window).scrollTop()&&r(e)});r(s)};n.allCategories=function(t){$.each(n.betRecord.suppliers,function(n,i){var r=i.Categories;i.isSelected=t;$.each(r,function(n,i){i.isSelected=t})});n.setCategoriesString()};n.selectSupplier=function(t,i){var r=!0;i&&n.allCategories(!1);$.each(n.betRecord.suppliers,function(n,u){var f=u.Categories;t===u.Value&&(i||(r=u.isSelected),u.isSelected=r,$.each(f,function(n,t){t.isSelected=r}))});n.setCategoriesString()};n.selectKind=function(t){var i=[];$.each(t.Categories,function(n,t){i.push(t.PropertyName)});n.allCategories(!1);$.each(n.betRecord.suppliers,function(n,t){var r=t.Categories;$.each(r,function(n,t){var r=$.inArray(t.PropertyName,i)!==-1;r&&(t.isSelected=!0)})});n.setCategoriesString()};n.checkSupplier=function(t){var i=!0;$.each(n.betRecord.suppliers,function(r,u){if(t===u.Text){var f=u.Categories;$.each(f,function(n,t){t.isSelected===!1&&(i=!1)});n.betRecord.suppliers[r].isSelected=i}})};n.setCategoriesString=function(){var t=[],i=0;if($.each(n.betRecord.suppliers,function(n,r){var u=r.Categories;$.each(u,function(n,r){i=i+1;r.isSelected&&t.push(r.ShortName)})}),t.length===i){n.betRecord.categoriesString="(全选)";return}if(t.length===0){n.betRecord.categoriesString="(无选取)";return}if(t.length<=2){n.betRecord.categoriesString=t.join("、");return}if(t.length>2){n.betRecord.categoriesString=t.slice(0,2).join("、")+"...共"+t.length+"个";return}};n.betDetail=function(n){i.post("/BetRecord/GetPlaycheckUrl",{id:n}).then(function(n){var t=n.data;if(t.IsSuccess===!1){f.alertError(t.ErrorMessage);return}var r=1024,i=(window.screen.width-r)/2;i<0&&(i=0);window.open(t.url,null,"width="+r+",height=768,top=200,left="+i)})}}]);app.controller("BetRecordPlusCtrl",["$scope","$q","$http","$timeout","bodyScrollService","MeidonTimeService","CustomModalService",function(n,t,i,r,u,f,e){function v(){y();r(function(){n.betRecord.status.isReady=!0;o();l()});$(document).on("scroll",function(){r(o)});n.$on("$destroy",c)}function y(){$(function(){var t=f.getCurrentMeidon();n.betRecord.wagersTimeBegin=n.betRecord.payoffTimeBegin=moment(t,"YYYY/MM/DD 00:00:00").format("YYYY/MM/DD 00:00:00");n.betRecord.wagersTimeEnd=n.betRecord.payoffTimeEnd=moment(t,"YYYY/MM/DD 23:59:59").format("YYYY/MM/DD 23:59:59")})}function o(){var r,u,t;h||n.betRecord.status.isDataAllLoaded||(r=$("#bet_record").scrollTop()+$("#bet_record").height(),u=$(document).scrollTop()+$(window).height(),r-u>1e3)||(t={SearchParams:{WagersTimeBegin:n.betRecord.searchTimeOption==1?n.betRecord.wagersTimeBegin:"",WagersTimeEnd:n.betRecord.searchTimeOption==1?n.betRecord.wagersTimeEnd:"",PayoffTimeBegin:n.betRecord.searchTimeOption==2?n.betRecord.payoffTimeBegin:"",PayoffTimeEnd:n.betRecord.searchTimeOption==2?n.betRecord.payoffTimeEnd:"",SearchTimeOption:n.betRecord.searchTimeOption,UnpayOnly:n.betRecord.unpayOnly},take:30,skip:n.betRecord.lists.length},n.betRecord.selectMemberGameCategories!=="all"&&n.betRecord.selectMemberGameCategories!==""&&(t.SearchParams.GameCategories=n.betRecord.selectMemberGameCategories),n.betRecord.status.isLoading=!0,h=i.post("/BetRecord/SearchBetRecord",t).then(function(i){if(n.betRecord.status.isLoading=!1,h=null,!i.data.IsSuccess){e.alertError(i.data.ErrorMessage).then(function(){n.betRecord.status.isDataAllLoaded=!0});c();return}n.betRecord.lists=n.betRecord.lists.concat(i.data.result);i.data.result.length<t.take&&(n.betRecord.status.isDataAllLoaded=!0,c())}))}function l(){var t={WagersTimeBegin:n.betRecord.wagersTimeBegin,WagersTimeEnd:n.betRecord.wagersTimeEnd,PayoffTimeBegin:n.betRecord.payoffTimeBegin,PayoffTimeEnd:n.betRecord.payoffTimeEnd,SearchTimeOption:n.betRecord.searchTimeOption,UnpayOnly:n.betRecord.unpayOnly};n.betRecord.selectMemberGameCategories!=="all"&&n.betRecord.selectMemberGameCategories!==""&&(t.GameCategories=n.betRecord.selectMemberGameCategories);i.post("/BetRecord/GetBetrecordTotalInfo",t).then(function(t){angular.extend(n.total,t.data);n.isSearchCompleted=!0})}function c(){$(document).off("scroll")}var h,a,s;n.betRecord={status:{isReady:!1,isLoading:!1,isDataAllLoaded:!1,memberGameCategoriesLoading:!1,showMemberGameCategoryDropdown:!1},lists:[],wagersTimeBegin:null,wagersTimeend:null,payoffTimeBegin:null,payoffTimeEnd:null,searchTimeOption:1,unpayOnly:!1,suppliers:[],kinds:[],allMemberGameCategories:[{Name:"全选",Category:"all"}],selectMemberGameCategories:"all",currentMemberGameCategoriesName:"全选"};n.total={};v();n.betRecord.submit=function(){var t=$(window).scrollTop();n.isSearchCompleted=!1;n.betRecord.lists=[];n.total={};n.betRecord.status.isDataAllLoaded=!1;$(document).on("scroll",function(){r(o)});r(function(){t===$(window).scrollTop()&&r(o)});r(l)};n.openLink=function(n,t){if(t){e.alertError(t);return}window.open(n)};s=!1;n.getMemberGameCategories=function(){if(!a||s){if(s){n.betRecord.status.showMemberGameCategoryDropdown=!n.betRecord.status.showMemberGameCategoryDropdown;return}n.betRecord.status.memberGameCategoriesLoading=!0;a=i.post("/BetRecord/GetMemberGameCategories").then(function(t){n.betRecord.status.memberGameCategoriesLoading=!1;s=!0;t.data.length===0?(n.betRecord.allMemberGameCategories=[{Name:"近期无游戏记录",Category:""}],n.betRecord.selectMemberGameCategories="",n.betRecord.currentMemberGameCategoriesName="近期无游戏记录"):(n.betRecord.allMemberGameCategories=n.betRecord.allMemberGameCategories.concat(t.data),n.betRecord.selectMemberGameCategories="all");n.betRecord.status.showMemberGameCategoryDropdown=!0})}};n.assignGameCategory=function(t,i){n.betRecord.status.showMemberGameCategoryDropdown=!n.betRecord.status.showMemberGameCategoryDropdown;n.betRecord.currentMemberGameCategoriesName=t;n.betRecord.selectMemberGameCategories=i},function(){$(document).on("click",function(){if(n.betRecord.status.showMemberGameCategoryDropdown){n.betRecord.status.showMemberGameCategoryDropdown=!1;n.$apply();return}})}()}]);app.controller("CdnCtrl",["$scope","$http","$sce",function(n,t,i){n.banners=[];n.Contents=[];t.post("/Cdn/GetPromotion").then(function(t){n.banners=n.banners.concat(t.data[0].items)});n.toHtml=function(n){return i.trustAsHtml(n)}}]);$(document).ready(function(){function u(){localStorage.setItem("LobbyNavAction","/Lobby/Activity");var n;n=window.open("/Lobby/Navigation","_lobbyNav","resizable,scrollbars=yes, width=1300, height=960");n.moveTo((screen.width-1300)/2,(screen.height-960)/3);n.focus();$.ajax({url:"/Home/AddLatestActivityClick",method:"POST",dataType:"json"})}function f(n){if(n.AdCategoryItems.length){var t=n.EntranceImg?'<img src="'+n.EntranceImg+'" style="max-width:145px;height:160px;cursor:pointer;" />':'<iframe src="https://cdn.weibo-hk.com/Web.Portal/_Common/Content/Views/Shared/images/LatestActivity/fish/fish.html" style="width:100%;height:100%;cursor:pointer;"><\/iframe>';i(t,"activity",u)}}function e(n){if(n.WalletRemittanceSwitch&&$('[ng-controller="SiteMailCountCtrl"]').length!=0)i('<img src="https://cdn.weibo-hk.com/Web.Portal/_Common/Content/Views/Shared/images/Service/WalletRemittance/wallet.gif"/>',"wallet-remittance",function(){var n;n=window.open("/WalletRemittance","_wallet","resizable,scrollbars=yes, width=1100, height=810");n.moveTo((screen.width-1100)/2,(screen.height-760)/3);n.focus()})}function o(n){if(n.YuebaoSwitch&&$('[ng-controller="SiteMailCountCtrl"]').length!=0)i('<img src="https://cdn.weibo-hk.com/Web.Portal/_Common/Content/Views/Shared/images/Service/Yuebao/piggy.gif"/>',"yuebao",function(){var n;n=window.open("/Yuebao","_yuebao","resizable,scrollbars=yes, width=1300, height=960");n.moveTo((screen.width-1300)/2,(screen.height-960)/3);n.focus()})}function i(t,i,u){var f='<div class="float-slide '+i+'">'+t+"<\/div>";$("#service-float").append(f);$("#service-float ."+i).on("click",function(){u()});$("#service-float ul.float-pager").append('<li data-pager="'+n+'"><\/li>');n===0&&($("#service-float").css("display","inline-block"),r(0));n===1&&$("#service-float > ul.float-pager").css("display","inline-block");n++}function r(n){$("#service-float > div.float-slide").removeClass("active");$("#service-float > ul.float-pager li").removeClass("active");$("#service-float > div.float-slide").eq(n).addClass("active");$("#service-float > ul.float-pager li").eq(n).addClass("active");t=n}function s(){var s=!1,i;$("body.layout").append('<style>#service-float { position:fixed; right:0; bottom:0; display:none; width:145px; height:160px; z-index:9999;}#service-float > div.float-slide { position:absolute; left:0; bottom:0; z-index:4; width:100%; height:100%; cursor:pointer; opacity:0; transition: opacity ease .5s; }#service-float > div.float-slide.active { opacity:1; z-index:5;}#service-float > ul.float-pager { position:absolute; top:-3px; left:0; right:0; display:none; text-align:left; z-index:10;}#service-float > ul.float-pager li { display:inline-block; width:12px; height:12px; vertical-align:top; margin:0 3px; font-size:0; background: #fff; border:1px solid #000; border-radius:50%; cursor:pointer; }#service-float > ul.float-pager li.active { background:#ffd053; }<\/style><aside id="service-float"><span class="closed" style="position:absolute;right:0;top:-10px;z-index:11;width:26px;height:26px;cursor:pointer;background:url(\'https://cdn.weibo-hk.com/Web.Portal/_Common/Content/Views/Shared/images/close.png\');"><\/span><ul class="float-pager"><\/ul><\/aside>').on("click","#service-float .closed",function(){$("#service-float").hide()}).on("click","#service-float ul.float-pager li",function(){r($(this).index())});$("#service-float").hover(function(){s=!0},function(){s=!1});setInterval(function(){n!==1&&(s||(t++,t===n&&(t=0),r(t)))},5e3);var a=angular.element(document.body).injector().get("ActivityService"),v=angular.element(document.body).injector().get("$q"),c=angular.element(document.body).injector().get("FunctionSwitchService"),y=$('[ng-controller="SiteMailCountCtrl"]').length!==0,u=[{action:a.getActivity(),callback:f,requireLogin:!1},{action:c.getFunctionSwitch(),callback:e,requireLogin:!0},{action:c.getFunctionSwitch(),callback:o,requireLogin:!0}],l=[],h=[];for(i=0;i<u.length;i++)(!u[i].requireLogin||u[i].requireLogin&&y)&&(l.push(u[i].action),h.push(u[i].callback));v.all(l).then(function(n){for(var t=0;t<h.length;t++)h[t](n[t])})}var n=0,t=0;s();$('[ng-click="toPgHtml()"]').remove();$("[ng-click=\"show='pg'\"]").remove();$('[ng-click="toPgFish2()"]').remove();$('[ng-click="toPgFish()"]').remove();$('[game-box="pg"]').remove();$(".pg").remove();$('[src="/SlotCasino/PgHtml"]').remove();$('[href="/Lobby/PG"]').remove()});$(document).ready(function(){function r(t){n();t.stopPropagation()}function n(){$(".atd-banner").hide()}function u(){e().done(function(){n();t.open({templateUrl:"/AnyTimeDiscount/DetailDialog",controller:"AnyTimeDiscountDetailDialogCtrl",windowClass:"modal-atd"}).result.then(function(){},function(){})})}function f(){return $('[ng-controller="SiteMailCountCtrl"]').length==0?!1:$.ajax({url:"/AnyTimeDiscount/GetMemberDiscountTotalAmount",method:"post",dataType:"json"}).done(function(n){if(n.totalAmount>0){var t=i(n.totalAmount);$(".atd-banner .banner-money").text(t);$(".atd-banner").show()}return n.totalAmount}).fail(function(){})}function e(){return $.ajax({url:"/AnyTimeDiscount/DetailDialog",method:"get",dataType:"html"})}if(typeof $.fn.marquee=="function"&&!0){var t=angular.element(document.body).injector().get("$modal"),i=angular.element(document.body).injector().get("currencyFilter");$("body.layout").append('<style>.atd-banner { position: fixed; bottom: 80px; z-index: 999; width: 100%; height: 0; display: none; }.atd-banner .banner-img { background: url("https://cdn.weibo-hk.com/Web.Portal/_Common/Content/Views/AnyTimeDiscount/images/title.png"); height: 80px; width: 500px; z-index:9999; line-height: 80px; position: relative; cursor: pointer; }.atd-banner .banner-close { position:absolute;right:14px;top:26px;z-index:5;width:28px;height:28px;cursor:pointer; }.atd-banner .banner-content { color: #000; }.atd-banner .banner-money { color: #ff0000; }.modal-atd .atd-frame { display: none; }<\/style>').append('<div id="atd-banner" class="atd-banner"><div class="banner-img text-center"><span class="banner-close"><\/span><span class="banner-content">您有返水 <span class="banner-money"><\/span> 可领取!<\/span><\/div><\/div>');$(".atd-banner").marquee({speed:2e4,pauseOnHover:!0}).on("click",".banner-close",r).on("click",".banner-img",u);f()}});app.controller("CompanyDepositApplicationsCtrl",["$scope","$http",function(n,t){var i=40;n.loadingPromise=null;n.records=[];n.loadMore=function(){if(!n.complete&&!n.loadingPromise){var r=n.records.length;n.loadingPromise=t.post("/AccountRecord/GetCompanyDepositApplications",{count:i,skip:r}).then(function(t){var r=t.data;angular.forEach(r,function(t){n.records.push(t)});n.loadingPromise=null;r&&r.length<i&&(n.complete=!0)})}};n.loadMore()}]);app.controller("CompanyDepositConfirmDialogCtrl",["$scope","$http","$window","$modalInstance","params","depositType","CustomModalService",function(n,t,i,r,u,f,e){n.params=u;n.depositType=f;n.apply=function(){n.isProcessing=!0;t.post("/CompanyDeposit/Apply",u).then(function(t){var i=t.data;n.isProcessing=null;i.IsSuccess?r.close(i.Id):e.alertError(i.ErrorMessage).then(function(){r.dismiss()})})};n.cancel=function(){r.dismiss("cancel")}}]);app.controller("CompanyDepositCtrl",["$scope","$http","$modal","$window","$filter","CustomModalService",function(n,t,i,r,u,f){var c,l,s,h,o,e;for(n.view="bank",c=new Date,l=$("html").attr("moment-lang"),$(".date").datepicker({format:"yyyy/mm/dd",language:l,autoclose:!0,todayHighlight:!0}),n.date=$(".date").datepicker("setValue",c).val(),n.hours=[],s=c.getHours().toString(),s.length==1&&(s="0"+s),o=0;o<24;o++)e=o.toString(),e.length==1&&(e="0"+e),e==s&&(n.hour=e),n.hours.push(e);for(n.minutes=[],h=c.getMinutes().toString(),h.length==1&&(h="0"+h),o=0;o<60;o++)e=o.toString(),e.length==1&&(e="0"+e),e==h&&(n.minute=e),n.minutes.push(e);n.params={};n.applyInfo={};n.loading=!0;t.post("/CompanyDeposit/Init").then(function(t){var u=t.data,i,r;n.depositTypes=u.DepositTypes;i=n.min=u.Min;r=n.max=u.Max;n.condition=i!=null&&r!=null?"between":i!=null&&r==null?"more":i==null&&r!=null?"less":"unlimited";n.loading=null});n.isAvailableAmount=function(t){n.amountInvalidMessage="";var i=n.min||.01,r=n.max;return!t&&t!==0?(n.amountInvalidMessage="请填写存入金额",!1):i!==null&&t<i?(n.amountInvalidMessage="存入金额必须大于: "+u("currency")(i,"$",2),!1):r!==null&&t>r?(n.amountInvalidMessage="存入金额必须小于: "+u("currency")(r,"$",2),!1):!0};n.selectBank=function(t,i){n.applyInfo.bank=t;n.params.groupAccountType=i};n.selectAccount=function(t){n.applyInfo.account=t;n.params.accountId=t.Id};n.selectDepositType=function(t){n.applyInfo.depositType=t;switch(t){case"ATM自动柜员机":case"ATM现金入款":n.showBranch=!0;n.branchTitle="ATM所属分行";break;case"银行柜台":n.showBranch=!0;n.branchTitle="银行柜台分行";break;case"手机银行转帐":case"网银转帐":default:n.showBranch=!1}};n.isBankViewAvailable=function(){return!n.orderId};n.isAccountViewAvailable=function(){return!n.orderId&&n.params.bankId||n.params.groupAccountType!="General"};n.isEditViewAvailable=function(){return!n.orderId&&n.params.bankId&&n.params.accountId||n.params.groupAccountType!="General"};n.isCompleteViewAvailable=function(){return n.orderId};n.openConfirmDialog=function(){if(!n.isAvailableAmount(n.params.amount)){f.alert("存入金额不符合限制");return}if(n.params.depositName.length>50){f.alert("存款人姓名不符合限制");return}if(n.params.groupAccountType=="General"&&!n.applyInfo.depositType){f.alert("请选择存款方式");return}if(n.showBranch){if(!n.branchProvince||!n.branchCity||!n.branchOther){f.alert(n.branchTitle+"填写不完整");return}n.params.memo=n.branchProvince+"省"+n.branchCity+n.cityType+n.branchOther}n.params.time=n.date+" "+n.hour+":"+n.minute;var t=i.open({templateUrl:"/CompanyDeposit/ConfirmDialog",controller:"CompanyDepositConfirmDialogCtrl",resolve:{params:function(){return n.params},depositType:function(){return n.applyInfo.depositType}}});t.result.then(function(t){t&&(n.orderId=t,n.switchView("complete"))})};n.switchView=function(i){switch(i){case"bank":n.view="bank";break;case"account":n.isAccountViewAvailable()&&(n.bankId!=n.params.bankId&&(n.params.accountId=null,n.loadingAccounts=!0,n.accounts=null,t.post("/CompanyDeposit/GetMemberCanUseAccounts",{bankName:n.applyInfo.bank,groupAccountType:n.params.groupAccountType}).then(function(t){var i=t.data;n.accounts=i;n.loadingAccounts=null;n.bankId=n.params.bankId})),n.view="account");n.view="account";break;case"edit":n.isEditViewAvailable()&&(n.view="edit",setTimeout(function(){$("#amount").focus();$("#zClip i").zclip({path:"/Scripts/ZeroClipboard.swf",copy:function(){return $(this).prev().text()},beforeCopy:function(){$(this).next().css("display","inline")},afterCopy:function(){$(this).next().fadeOut(3e3)}})}));break;case"complete":n.isCompleteViewAvailable()&&(n.view="complete")}}}]);app.controller("ContactCtrl",["$scope","$http",function(){}]);app.controller("CountryBlockedCtrl",["$scope","$window",function(n,t){var i=window.__siteSetting?window.__siteSetting.LayoutCtrl:{};n.lineChatClick=function(n){var f=(new Date).getTime(),r=588,u=486,e;i&&i.lineChat&&(r=i.lineChat.width?i.lineChat.width:r,u=i.lineChat.height?i.lineChat.height:u);n=n.indexOf("?")!=-1?n+"&_="+f:n+"?_="+f;e=t.open(n,"_open","width="+r+",height="+u);e.focus()};n.qqClick=function(n){var r="http://wpa.qq.com/msgrd?v=3&uin="+n+"&site=qq&menu=yes",u=588,f=486,e;i&&i.QQ&&(r=i.QQ.link?i.QQ.link.replace("QQVal",n):r,u=i.QQ.width?i.QQ.width:u,f=i.QQ.height?i.QQ.height:f);e=t.open(r,"_open","width="+u+",height="+f);e.focus()}}]);app.controller("DeviceBindingConfirmDialogCtrl",["$scope","$modalInstance",function(n,t){function i(n){t.close(n)}function r(){i(!0)}function u(){i(!1)}n.ok=r;n.cancel=u}]);app.controller("GameMaintenanceCtrl",["$scope","$http","$compile","$timeout","LobbyNavService",function(n,t,i,r,u){function s(){t.post("/GameNavigationSort/GetMaintenanceGames",{gameSupplierType:parseInt(_sup),gameCategoryType:parseInt(_cate),gameKind:_kind}).then(function(t){n.games=t.data;for(var i=0;i<n.games.length;i+=f)e.push(n.games.slice(i,i+f));h()})}function h(){for(var t,s,h,l,c="",u=0;u<e.length;u++){for(t="<ul>",s=0;s<e[u].length;s++)h=u*f+s,l='<li class="entrance" ng-click="openLink('+h+')">    <img ng-src="https://cdn.weibo-hk.com/Multimedia/Navigation/Web/term/'+n.games[h].ImageFileName+'" />    <span>'+n.games[h].NameCn+"<\/span><\/li>",t=t+l;t=t+"<\/ul>";c=c+t}r(function(){$(".slider-section").append(c);$(".slider-section").slick(o);i($(".slider-section").contents())(n)})}function c(t){n.games[t].IsEmbedded||u.addToNonEmbedded(n.games[t].Name);u.openLobbyNav(n.games[t].Url,n.games[t].Name)}var o={dots:!0,autoplay:!0,autoplaySpeed:5e3,slidesToShow:1,slidesToScroll:1,arrows:!0,prevArrow:'<button type="button" class="slick-prev"><\/button>',nextArrow:'<button type="button" class="slick-next"><\/button>'},f=10,e=[];n.games=[];n.openLink=c;s()}]);app.controller("HomeCtrl",["$scope","$element","$window","$http","$interval",function(n,t,i,r,u){function o(){f&&u.cancel(f);f=u(function(){n.selectedImg=n.selectedImg==e?1:n.selectedImg+1},3e3)}var f,e;n.slideBannerClick=function(){i.open("/Promotion","_self","resizable,scrollbars=yes")};r.post("/Cdn/GetSlider").then(function(t){var i=t.data;e=i.length;n.slideImgs=i;o()});n.changeSelected=function(t){n.selectedImg=t+1;o()}}]);app.controller("JoinAgentCtrl",["$scope","$http","$window","CustomModalService",function(n,t,i,r){n.joinAgent=function(){r.confirm("确定要加盟股东?").then(function(n){n&&t.post("/AboutMe/JoinAgent").then(function(n){var t=n.data;if(!t.IsSuccess){r.alertError(t.ErrorMessage);return}r.alert("成功加盟股东").then(function(){i.location.reload()})})})}}]);app.controller("LayoutCtrl",["_env","$location","$scope","$window","ContactInfoService","MarqueeService","MeidonTimeService","CustomModalService",function(n,t,i,r,u,f,e,o){i.env=n.LayoutCtrl;e.on(function(n){i.meiDonNow=n});u.getContactInfo().then(function(n){i.ContactInfo=n});f.getMarquee().then(function(n){i.newsBags=n});i.newsClick=function(){i.isMarqueeShowClass=!0};i.closeMarquee=function(){i.isMarqueeShowClass=!1};i.noviceClick=function(){var n=r.open("http://pk3755.com/","_open","width=1490,height=650");n.focus()};i.lineChatClick=function(n,t,u,f){var s=(new Date).getTime(),h=t||i.env.lineChat.target,l=u||i.env.lineChat.width,a=f||i.env.lineChat.height,o=n||i.ContactInfo[i.env.lineChat.cdnKey]||i.ContactInfo.Live800Link,c,e;o+=o.indexOf("?")!==-1?"&_="+s:"?_="+s;c=h==="_blank"?"":"width="+l+",height="+a;e=r.open(o,h,c);!i.env.lineChat.fullScreen||u||f||(e.moveTo(0,0),e.resizeTo(screen.width,screen.height));e.focus()};i.qqClick=function(n,t,r){var u=t||i.env.QQ.width,f=r||i.env.QQ.height,e=i.env.QQ.link.replace("QQVal",n),o=window.open(e,"_open","width="+u+",height="+f);!i.env.QQ.fullScreen||t||r||(linechat.moveTo(0,0),linechat.resizeTo(screen.width,screen.height));o.focus()};i.FreePlayClick=function(){var n=window.open("/Trial/Apply");n.focus()};i.GpkBingoClick=function(){var n=window.open("http://gpk-gameinfo.com/GALAXYonline.mp4","_open","width=588,height=486");n.focus()};i.liveCasinoClick=function(){var n=window.open("http://gpk-gameinfo.com/Live_casino/","_blank","width=1000,height=800");n.focus()};i.AgentLoginClick=function(){var n=r.open(i.ContactInfo.AgentLogin,"_blank");n.focus()};i.RegisterClick=function(){var n=r.open("/Register","_parent");n.focus()};i.AgentApplyClick=function(){var n=r.open("/AgentApply","_parent");n.focus()};i.addFavoriteClick=function(){var n=t.protocol()+"://"+t.host(),i=$(document).prop("title");try{window.external.addFavorite(n,i)}catch(r){try{window.sidebar.addPanel(i,n,"")}catch(r){o.alert("请按 Ctrl+D 键添加到收藏夹","notice")}}};i.addHomePageClick=function(){var n=t.protocol()+"://"+t.host();document.all?(document.body.style.behavior="url(#default#homepage)",document.body.setHomePage(n)):o.alert("您的浏览器目前不支援此功能！")};i.$on("showRegisterDialog",function(){i.toggleRegisterDialog(!0)});i.toggleRegisterDialog=function(n){i.registerDialog=n!==undefined?n:!i.registerDialog}}]);app.controller("LobbiesCtrl",["$scope","$rootScope","LobbyNavService","gameNavigationSortService","CustomModalService",function(n,t,i,r,u){function e(){u.alert("游戏停止合作,即将下架")}function f(n){i.openLobbyNav("/Account/LoginToSupplier?supplierType=1&externalType="+n+"","Bb")}function s(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=3&externalType=","Saba")}function o(n){i.openLobbyNav("/Account/LoginToSupplier?supplierType=6&externalType="+n,"Ag")}function h(t){angular.forEach(t,function(t){n["to"+t.Name]=c(t)})}function c(n){return function(){n.IsEmbedded?null:i.addToNonEmbedded(n.Name);i.openLobbyNav(n.Url,n.Name)}}n.isLogin=function(){return t.user&&t.user.isLogin};n.maintain=function(){n.isLogin()&&u.alert("升级中")};n.toBbSport=function(){f(0)};n.toBbLottery=function(){f(1)};n.toBbLive=function(){f(3)};n.toBbGame=function(){i.openLobbyNav("/SlotCasino/BbinHtml","BbinList")};n.toSabaGame=function(){s()};n.toSabaESport=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=3&externalType=esports","Saba")};n.toMgDealer=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=9&externalType=1","Mg2")};n.toMgFlash=function(){i.openLobbyNav("/SlotCasino/MgFlash","Mg2List")};n.toAgLive=function(){o(1)};n.toAgHtml=function(){i.openLobbyNav("/SlotCasino/AgHtml","AgList")};n.toPtLive=function(){i.openLobbyNav("/LiveCasino/PtLive","Pt2List")};n.toPtFlash=function(){i.openLobbyNav("/SlotCasino/PtFlash","Pt2List")};n.toGpiLive=function(){i.openLobbyNav("/LiveCasino/GpiLive","GpiList")};n.toGpiFlash=function(){i.openLobbyNav("/SlotCasino/GpiFlash","GpiList")};n.toSingSport=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=13","Sing")};n.toEvoLive=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=29","Evo")};n.toGnsHtml=function(){i.openLobbyNav("/SlotCasino/GnsHtml","GnsList")};n.toPrgFlash=function(){i.openLobbyNav("/SlotCasino/PrgFlash","PrgList")};n.toSgFlash=function(){i.openLobbyNav("/SlotCasino/SgFlash","SgList")};n.toHabaHtml=function(){i.openLobbyNav("/SlotCasino/HabaHtml","HabaList")};n.toJdbHtml=function(){i.openLobbyNav("/SlotCasino/JdbHtml","JdbList")};n.toJdbBoard=function(){i.openLobbyNav("/BoardCasino/JdbHtml","JdbList")};n.toNetentHtml=function(){i.openLobbyNav("/SlotCasino/NetentHtml","NetEntList")};n.toAbLive=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=17","Ab")};n.toUgGame=function(){e()};n.toMwHtml=function(){i.openLobbyNav("/SlotCasino/MwHtml","Mw2List")};n.toIgLottery=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=21&externalType=0","Ig")};n.toIgMarkSix=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=21&externalType=1","Ig")};n.toBgLive=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=31","Bg")};n.toLatestGame=function(){i.openLobbyNav("/Lobby/LatestGame","LatestGame")};n.toLatestActivity=function(){i.openLobbyNav("/Lobby/Activity","Activity")};n.toCq9Html=function(){i.openLobbyNav("/SlotCasino/Cq9Html","Cq9List")};n.toGdLive=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=32","Gd")};n.toGdHtml=function(){i.openLobbyNav("/SlotCasino/GdHtml","GdList")};n.toRedTigerHtml=function(){i.openLobbyNav("/SlotCasino/RedTigerHtml","RedTigerList")};n.toSunbetLive=function(){i.openLobbyNav("/LiveCasino/SunbetLive","SunbetList")};n.toGameArtHtml=function(){i.openLobbyNav("/SlotCasino/GameArtHtml","GameArtList")};n.toIsbHtml=function(){i.openLobbyNav("/SlotCasino/IsbHtml","IsbList")};n.toCmdSport=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=38","Cmd")};n.toLgHtml=function(){i.openLobbyNav("/SlotCasino/LgHtml","LgList")};n.toKgHtml=function(){i.openLobbyNav("/BoardCasino/KgHtml","KgList")};n.toCity761Html=function(){i.openLobbyNav("/BoardCasino/City761Html","City761")};n.toLxLottery=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=44","Lx")};n.toRgBoard=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=25&gId=4791","Rg")};n.toRgBoard2=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=25&gId=5340","Rg")};n.toPtsHtml=function(){i.openLobbyNav("/SlotCasino/PtsHtml","PtsList")};n.toEbetLive=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=46","EBet")};n.toImSport=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=47","Im")};n.toPngHtml=function(){i.openLobbyNav("/SlotCasino/PngHtml","PngList")};n.toOgLive=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=49","Og")};n.toRgLottery=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=25","Rg")};n.toVrLottery=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=50","Vr")};n.toGpkCandy=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=25&gId=5341","Gpk")};n.toGpkHtml=function(){i.openLobbyNav("/IntegratedGame/GpkHtml","GpkList")};n.toGpkSlot=function(){i.openLobbyNav("/IntegratedGame/GpkHtml?CategoryKey=75","GpkList")};n.toGpkBoard=function(){i.openLobbyNav("/IntegratedGame/GpkHtml?CategoryKey=71","GpkList")};n.toGpkLive=function(){};n.toGpkLotteryPoker=function(){};n.toGpkLotterySport=function(){};n.toFsHtml=function(){i.openLobbyNav("/SlotCasino/FsHtml","FsList")};n.toFsBoard=function(){i.openLobbyNav("/BoardCasino/FsHtml","FsList")};n.toIboSport=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=55","Ibo")};n.toImsSport=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=54","Ims")};n.toNwBoard=function(){i.openLobbyNav("/BoardCasino/NwHtml","NwList")};n.toKaHtml=function(){i.openLobbyNav("/SlotCasino/KaHtml","KaList")};n.toSaLive=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=53","Sa")};n.toSaHtml=function(){i.openLobbyNav("/SlotCasino/SaHtml","SaList")};n.toGpk2Html=function(){i.openLobbyNav("/SlotCasino/Gpk2Html","GtiList")};n.toPsHtml=function(){i.openLobbyNav("/SlotCasino/PsHtml","PlsList")};n.toJsHtml=function(){i.openLobbyNav("/SlotCasino/JsHtml","JsList")};n.toJsBoard=function(){i.openLobbyNav("/BoardCasino/JsHtml","JsList")};n.toMtHtml=function(){i.openLobbyNav("/SlotCasino/MtHtml","MtList")};n.toMtBoard=function(){i.openLobbyNav("/BoardCasino/MtHtml","MtList")};n.toRecommendGame=function(){i.openLobbyNav("/Lobby/RecommendGame?CategoryKey=74","RecommendList")};n.toRtgHtml=function(){i.openLobbyNav("/SlotCasino/RtgHtml","RtgList")};n.toMg3Live=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=41&externalType=1","Mg3")};n.toMg3Flash=function(){i.openLobbyNav("/SlotCasino/Mg3Flash","Mg3List")};n.toPt3Live=function(){i.openLobbyNav("/LiveCasino/Pt3Live","Pt3List")};n.toPt3Html=function(){i.openLobbyNav("/SlotCasino/Pt3Html","Pt3List")};n.toAeHtml=function(){i.openLobbyNav("/SlotCasino/AeHtml","AeList")};n.toThHtml=function(){i.openLobbyNav("/SlotCasino/ThHtml","ThList")};n.toThBoard=function(){i.openLobbyNav("/BoardCasino/ThHtml","ThList")};n.toDhBoard=function(){i.openLobbyNav("/BoardCasino/DhHtml","DhList")};n.toIbo2Live=function(){};n.toJtnHtml=function(){i.openLobbyNav("/SlotCasino/JtnHtml","JtnList")};n.toBfLottery=function(){};n.toDtHtml=function(){i.openLobbyNav("/SlotCasino/DtHtml","DtList")};n.toDtBoard=function(){i.openLobbyNav("/BoardCasino/DtHtml","DtList")};n.toDtESport=function(){};n.toFish=function(){i.openLobbyNav("/SlotCasino/Fish","FishList")};n.toAgFish=function(){o(6,36)};n.toUgFish=function(){e()};n.toMwFish=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=36&gId=2814","Mw2")};n.toPtFish=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=11&gId=1740&externalType=1","Pt2")};n.toPt3Fish=function(){};n.toJdbFish=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=26&gId=1982","Jdb")};n.toJdbFish2=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=26&gId=3874","Jdb")};n.toJdbFishMoney=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=26&gId=4794","Jdb")};n.toGnsFish=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=14&gId=2874","Gns")};n.toRgFish=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=25&gId=3867","Rg")};n.toRgFish2=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=25&gId=4746","Rg")};n.toRgCutFish=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=25&gId=5316","Rg")};n.toBbFish=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=1&gId=4108","Bb")};n.toBbFish2=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=1&gId=4107","Bb")};n.toPtsFish=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=45&gId=4312","Pts")};n.toCq9Fish=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=28&gId=5229","Cq9")};n.toCq9FishGo=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=28&gId=5671","Cq9")};n.toCity761Fish=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=51&gId=4761","City761")};n.toCity761FishJinChan=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=51&gId=6161","City761")};n.toFsFishBeauty=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=52&gId=4910","Fs")};n.toFsFishThunder=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=52&gId=4911","Fs")};n.toFsFishBird=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=52&gId=4912","Fs")};n.toFsFishHappy=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=52&gId=4913","Fs")};n.toFsFishEveryDay=function(){i.openLobbyNav("/Account/LoginToSupplier?supplierType=52&gId=4914","Fs")};n.toSaFish=function(){};n.toJsFish=function(){};n.toMtFishLee=function(){};n.toMtFishToad=function(){};n.toThFishLee=function(){};n.toThFishToad=function(){};n.toBgFish=function(){};n.toBbinRule=function(){i.openLobbyNav("http://777.gpk-online.com/","Guide","Guide")};n.toSabaRule=function(){i.openLobbyNav("http://gpk-gameinfo.com/world_cup/brasil02.html","Guide","Guide")};n.toAGRule=function(){i.openLobbyNav("http://gc.ag-game.net/agingame/rules/BAC_TR.htm","Guide","Guide")};n.toMGRule=function(){i.openLobbyNav("https://livegames.gameassists.co.uk/HelpCenter/Diamond/LiveGames/zh-tw/Default.htm#cshid=1","Guide","Guide")};r.getGameEntranceList().then(function(n){h(n)})}]);app.controller("LobbyNavCtrl",["$scope","$window","$timeout","$http","languageService","LobbyNavService","gameNavigationSortService",function(n,t,i,r,u,f,e){function l(){var t=u.currentLanguage;n.langPropertyName=u.getLangPropertyName(t);e.getGameNavigationSort().then(function(t){n.navInfoList=t}).then(p)}function s(){n.isShow=!((_isUserLogin==="False"||!_isUserLogin)&&n.lobbyAction.indexOf("/Account/LoginTo")==0)}function h(){n.lobbyAction=localStorage.getItem("LobbyNavAction");s()}function a(n,t){var i={};i.NavigationKind=t.NavigationKind;i.LangKey=n.Name;r.post("/GameNavigationSort/SetGameNavigationClickRecord",i);n.IsEmbedded||f.addToNonEmbedded(n.Name);f.openLobbyNav(n.Url,n.Name)}function v(t){n.currentKind=t.NavigationKind}function c(i){function f(){$(i+" .lobbyNav-list").height($(window).innerHeight()-260);$(i+" .lobbyNav-list").mCustomScrollbar({alwaysShowScrollbar:1})}var u=275;o>u&&(n.slideLeft=function(){$(i+" .lobbyNav-category ul").stop(!0,!1).animate({left:8},500)},n.slideRight=function(){$(i+" .lobbyNav-category ul").stop(!0,!1).animate({left:-o+u},500)});$(window).on("resize",f);$(i).on("mouseover",function(){$(i).hasClass("slide-show")||r.post("/GameNavigationSort/SetGameNavigationClickRecord",{NavigationKind:-1,LangKey:null});$(i).addClass("slide-show")});$(i).on("mouseleave",function(n){(n.pageX>$(i).width()||n.pageX<0||n.pageY<0||n.pageY>t.innerHeight)&&$(i).removeClass("slide-show")});f()}function y(){n.lobbyAction=localStorage.getItem("LobbyNavAction")||"/Lobby/Activity";t.addEventListener("storage",function(t){t.key==="LobbyNavAction"?n.$apply(h):null});t.addEventListener("setActionEvent",h)}function p(){w();i(function(){b();c(".LobbyNav")});n.currentKind=n.navInfoList[0].NavigationKind;n.checkListKind=k;n.isShow=!0;n.openLobbyView=a;n.changeNavKind=v;y();s();c(".LobbyNav")}function w(){for(var r,t=[],i=0;i<n.navInfoList.length;i++)for(r=0;r<n.navInfoList[i].NavigationSortList.length;r++)t.push(n.navInfoList[i].NavigationSortList[r]);angular.forEach(t,function(n,i){t[i]=['.LobbyNav .lobbyNav-list li.navsort[game-box="'+n.Name+'"] {',"    background-image: url('https://cdn.weibo-hk.com/Multimedia/Navigation/Web/term/"+n.ImageFileName+"');","}"].join("\n")});t.push("<\/style>");angular.element(".style-container").css("display","none").append('<style type="text/css">\n'+t.join("\n"))}function b(){var t=angular.element("ul.lobbyNav-category"),n=0;angular.forEach(t.children(),function(t){n=n+angular.element(t)[0].offsetWidth+2});o=n;t.css("width",n+"px")}function k(n){for(var i=[{kind:1,listClass:"hot-list"},{kind:2,listClass:"new-list"}],t=0;t<i.length;t++)if(i[t].kind==parseInt(n))return i[t].listClass}var o=0;l()}]);app.controller("LoginCtrl",["$scope","$http","labelService","$window","$timeout","$rootScope","$modal","injectActionService","CustomModalService","captchaService","signalrService",function(n,t,i,r,u,f,e,o,s,h,c){function rt(n){setMaxDigits(129);var t=new RSAKeyPair(k,"",d);
return encryptedString(t,n)
}function g(n){try{Fingerprint2.get(function(t){var i=[],r;angular.forEach(t,function(n){i.push(n.value)});r=Fingerprint2.x64hash128(i.join(""),31);n.fingerprint=r;p(n)})}catch(t){n.fingerprint="";p(n)}}function p(r){n.isProcessing=!0;r.signalRId=c.getConnectionId();t.post("/Account/GetRSAKey").then(function(n){var e,u;k=n.data.exponent;d=n.data.modulus;e=["length","stringify","extend"],function(n,t){var i=function(t){while(--t)n.push(n.shift())};i(++t)}(e,253);var o=function(n){n=+n;return e[n]},nt=JSON[o("0x0")](angular[o("0x1")](angular.extend({},r),b)),h=encodeURIComponent(nt),y=100,g=[];for(u=0;u<h[o("0x2")];u+=y)g.push(rt(h.substr(u,y)));t.post("/Account/Login",g).then(function(n){var t=n.data,u,e,o;if(t.IsNeCaptchaFailed){f.$broadcast("reInitNECaptcha"+l);return}if(f.$broadcast("closeCaptchaModal"+l),t.IsSuccess){if(!t.IsNeedGpkAuthenticator){w();return}if(u=!!t.GpkAuthenticatorInfo.LoginQrCode,u){v(t.GpkAuthenticatorInfo);return}tt().then(function(n){if(!n){r.passGpkAuth=!0;p(r);return}v(t.GpkAuthenticatorInfo)})}else{if(t.CheckType&&t.Token){e={account:r.account,checkType:t.CheckType,token:t.Token,signalRId:c.getConnectionId()};ft(e);return}o=t.ReturnObject?'<br/><a href="javascript:void(0)" line-chat-click><i class="fas fa-headphones"><\/i> '+i.get("Register.ContactCustomerService")||"联系客服<\/a>":"";s.alertError(t.ErrorMessage+o).then(function(){a()})}})})}function w(){if(n.loginToGame!==undefined){var t="/Account/"+decodeURIComponent(n.loginToGame);r.location.href=t;r.top!=r.self&&r.top.location.reload();r.top.opener.top.opener!==null&&r.top.opener.top.opener.location.reload();r.top.opener.top.location.reload()}else location.href.indexOf("/Account/LoginToGame?ReturnUrl=")!==-1&&(n.loginToPage=location.search.replace("?ReturnUrl=",""),location.pathname===n.loginToPage?r.opener.location.reload():r.opener.location.href=n.loginToPage,r.close()),location.pathname==="/Account/Login"?r.location.href="/":r.location.reload()}function a(){n.loginParams.checkCode=null;n.isProcessing=!1;$("#check-code-wrapper input").focus()}function ft(n){for(var r=[{type:1,question:i.get("Register.Enter_AccountName")||"请输入姓名",prompt:s.prompt},{type:2,question:i.get("Register.Enter_WithdrawPassword")||"请输入取款密码",prompt:s.promptPwd}],u,t=0;t<r.length;t++)if(r[t].type===n.checkType){u=r[t];break}u.prompt(u.question).then(function(t){if(!t){s.alert(i.get("Register.Verify_Error")||"验证失败");a();return}n.verifyMessage=t;nt(n)})}function nt(n){t.post("/Account/Login_C",n).then(function(t){var i=t.data,r;if(!i.IsSuccess){s.alertError(i.ErrorMessage);a();return}if(!i.IsNeedGpkAuthenticator){w();return}if(r=!!i.GpkAuthenticatorInfo.LoginQrCode,r){v(i.GpkAuthenticatorInfo);return}tt().then(function(t){if(!t){n.passGpkAuth=!0;nt(n);return}v(i.GpkAuthenticatorInfo)})})}function v(t){e.open({templateUrl:"/Account/QrCodeAuthentication",controller:"QrCodeAuthenticationCtrl",windowClass:"modal-qca",resolve:{authInfo:function(){return t}}}).result.then(function(){n.isProcessing=!1},function(){n.isProcessing=!1})}function tt(){return e.open({templateUrl:"/Account/DeviceBindingConfirmDialog",controller:"DeviceBindingConfirmDialogCtrl",windowClass:"modal-dbcd",backdrop:"static"}).result.then(function(n){return n},function(){return!1})}var l,b,k,d,ut,y,it;c.connect();c.on("gpkAuthSuccessToLogin",function(n){if(!n||n.length===0){s.alertError(i.get("Account.LoginFailed")||"登入失败，请重新登入。");a();return}for(var t=0;t<n.length;t++)document.cookie=n[t];w()});b={};ut=o.LoginCtrl.loginAction;n.loginParams={account:$("#login_account").val(),password:$("#login_password").val()};n.isProcessing=!1;n.login=function(t){n.loginOver=!1;var r=document.getElementById("agree");if(r.style.display="block",!n.checkCode){s.alert(i.get("Shared.Empty_Checkcode")||"验证码为空, 请取得验证码");return}t.checkCodeEncrypt=n.checkCode.encrypt;n.loginToGame=location.search.split("LoginToGame=")[1];l=h.verifyViaDialogForLogin();l?n.$on("validateNECaptcha"+l,function(n,i){t.neCaptcha=i;g(t)}):g(t)};n.agreement=function(){var t=(screen.width-850)/2,i=(screen.height-800)/3,n=r.open("/Home/Agreement","","resizable,scrollbars=yes, width=900, height=850");n.moveBy(t,i);n.focus()};n.loginOver=!1;y=$("#agree");it=$("#login-box");it.hover(function(){y.fadeIn(1e3);n.loginOver=!n.loginOver},function(){n.loginOver=!n.loginOver});y.hover(function(){n.loginOver=!n.loginOver},function(){y.fadeOut(1e3);n.loginOver=!n.loginOver})}]);app.controller("LoginToGameCtrl",["$scope","$window",function(n,t){n.GameRegisterClick=function(){if(t.top.opener!==null){for(var n=t.top.opener.top,i=t.document.domain;n.opener!==null&&n.opener!==n;)try{n.opener.document.domain==i&&(n.close(),n=n.opener.top)}catch(r){break}t.top.close();n.location.href="/Register"}else t.top.location.href="/Register"}}]);app.controller("MemberCenterCtrl",["$scope","$window","$http","$q","FunctionSwitchService",function(n,t,i,r,u){function e(){o();s().then(function(){h();n.isLoading=!1})}function o(){var t=$(".body #title"),n=document.createElement("style");n.type="text/css";n.innerHTML=".custom-mc-color { color: "+t.css("color")+";}.custom-mc-bg { background-color: "+t.css("background-color")+";}";$("#member-center").append(n)}function s(){return r.all([u.getFunctionSwitch(),i.post("/Home/GetGpkAuthEnable",null)]).then(function(t){var i=t[0];n.isWalletRemittanceEnable=i.WalletRemittanceSwitch;n.isYuebaoEnable=i.YuebaoSwitch;n.isGpkAuthEnable=t[1].data.Enable})}function h(){for(var r=t.location.pathname,i=0;i<f.length;i++)if(f[i].path===r){n.page={category:f[i].category};return}}var f=[{category:"Security",path:"/MemberCenter/SecurityList"},{category:"Security",path:"/Account/AuthenticatedDevice"},{category:"Security",path:"/Account/ChangePassword"},{category:"Security",path:"/Account/ChangeMoneyPassword"},{category:"Announcement",path:"/SiteMail"},{category:"Wallet",path:"/MemberCenter/WalletList"}];n.isLoading=!0;n.page={category:"Security"};e()}]);app.controller("OnlineDepositCtrl",["$scope","$http","$window","CustomModalService",function(n,t,i,r){function e(t){switch(n.condition){case"between":return t>=n.min&&t<=n.max;case"more":return t>=n.min;case"less":return t>0&&t<=n.max;default:return!0}}var f=[1e5,5e4,3e4,2e4,9950,9025,8855,7952,7018,6150,5252,4785,4230,3975,3500,2850,2322,1925,1668,1205,1018,800,728,656,589,500,448,400,359,300,256,200,125,109,100,50,1],u=$("html").attr("payment-type");n.loading=!0;t.post("/OnlineDeposit/GetDepositRule",{type:u}).then(function(t){var u=t.data;if(!u.IsSuccess){r.alertError(u.ErrorMessage).then(function(){i.location.reload()});return}n.min=u.Min||1;n.max=u.Max;n.availableAmounts=[];angular.forEach(f,function(t){e(t)&&n.availableAmounts.push(t)});n.availableAmounts.length&&(n.amount=n.availableAmounts[0]);n.loading=null});u==="PointCard"&&(t.post("/OnlineDeposit/GetPointCardFeeSetting").then(function(t){var u=t.data;if(!u.IsSuccess){r.alertError(u.ErrorMessage).then(function(){i.location.reload()});return}n.PointCardFee=u}),n.calculate=function(){var t=n.depositAmount*(n.PointCardFee.Percent/100);n.PointCardFee.FeeMax?t>n.PointCardFee.FeeMax?(n.actualDepositAmount=n.depositAmount-n.PointCardFee.FeeMax,n.depositFee=n.PointCardFee.FeeMax):(n.actualDepositAmount=n.depositAmount-t,n.depositFee=t):(n.actualDepositAmount=n.depositAmount-t,n.depositFee=t)},n.showCalculation=function(t){n.isShowCalculation=t})}]);app.controller("OnlineDepositPaymentCtrl",["$scope","$http","$q","$window","$filter","CustomModalService","PaymentService","labelService","languageService",function(n,t,i,r,u,f,e,o,s){function y(){var n=$(".body.container #title"),t=".custom-deposit-color { color: "+n.css("color")+" !important; }.custom-deposit-bg { background-color: "+n.css("background-color")+"}.custom-deposit-color-r { color: "+n.css("background-color")+" }.custom-deposit-bg-r { background-color: "+n.css("color")+"}.custom-deposit-hover:hover { color: "+n.css("color")+"; background-color: "+n.css("background-color")+"; }.custom-deposit-border-color { border-color:"+n.css("background-color")+" !important; }";$("#base-css").append(t)}function p(){t.post("/OnlineDeposit/GetPaymentList",{paymentyType:n.payment.Id}).then(function(t){if(n.paymentList=t.data,n.paymentList.length===0){c({ResultType:"NotAvailable",ErrorMessage:""});n.isLoading=!1;return}n.amountValidate={errorMsg:null};w();n.selectPayment(n.paymentList[0]);n.isLoading=!1});n.payment.Id===2&&t.post("/OnlineDeposit/GetPointCardFeeSetting").then(function(t){var i=t.data;if(!i.IsSuccess){f.alertError(i.ErrorMessage).then(function(){r.location.reload()});return}n.PointCardFee=i})}function w(){for(var i=1,t=0;t<n.paymentList.length;t++)n.paymentList[t].RecommendationMemo=n.paymentList[t].RecommendationMemo||n.payment.Name+" - 0"+i++,n.paymentList[t].DepositLimitDescription=b(n.paymentList[t].Min,n.paymentList[t].Max)}function b(n,t){var r='<span class="deposit-highlight">'+u("noFractionCurrency")(n,"",0)+"<\/span>",f='<span class="deposit-highlight">'+u("noFractionCurrency")(t,"",0)+"<\/span>",i="";return n&&t?(i=o.get("OnlineDeposit.DepositLimitBetween")||"{0} 元 ~ {1} 元",i=i.replace("{0}",r).replace("{1}",f)):!n&&t?(i=o.get("OnlineDeposit.DepositLimitLess")||"{0} 元以下",i=i.replace("{0}",f)):n&&!t?(i=o.get("OnlineDeposit.DepositLimitMore")||"{0} 元以上",i=i.replace("{0}",r)):i=o.get("OnlineDeposit.DepositLimitUnlimit")||"未限制",i}function k(t){var i={Amount:t.Amount,SettingId:t.SettingId,PaymentyType:n.payment.Id};v(i)}function v(n){t.post("/OnlineDeposit/Send_V2",n).then(function(n){for(var i=n.data,t=0;t<h.length;t++)if(h[t].type===i.ResultType){h[t].callback(i);return}})}function d(t){n.deposit.select=t.SelectBankObject;n.sendParams={Bank:n.deposit.select.Banks&&n.deposit.select.Banks.length?n.deposit.select.Banks[0].Value:null,Amount:n.deposit.select.Amount,SettingId:n.deposit.select.SettingId,PaymentyType:n.payment.Id};n.deposit.component="SelectBank"}function g(t){n.depositLimitsErrorMessage=t.DepositLimitsErrorMessage}function c(t){n.deposit.error.type=t.ResultType;n.deposit.error.errorMessage=t.ErrorMessage;n.deposit.component="NotAvailable"}function nt(t){n.deposit.info=t.DTPPViewModel;n.deposit.component="DTPPPay"}function tt(n){r.location.href=n.RedirectUrl}var h,l,a;n.isLoading=!0;n.payment={};n.deposit={component:"Form",error:{},info:{},select:{},redirect:{}};h=[{type:"Send",callback:k},{type:"SelectBank",callback:d},{type:"DepositLimitsError",callback:g},{type:"IsLock",callback:c},{type:"ErrorNotAvailable",callback:c},{type:"NotAvailable",callback:c},{type:"DTPPPay",callback:nt},{type:"Redirect",callback:tt}];n.createParams={};n.sendParams={};n.selectedPayment={};l=location.search.substr(1);a=JSON.parse('{"'+l.replace(/\=/gi,'":"').replace(/\&/gi,'","')+'"}');n.payment=e.getPaymentByType(a.type);y();i.all([t.post("/Home/GetCurrentUserIsLock"),s.getMultilingual()]).then(function(t){if(n.isLock=t[0].data.IsLock,n.langs=t[1].data,n.payment.Name=n.langs["OnlineDeposit_"+n.payment.LangKey],document.title=n.langs.Shared_Head_Title+" - "+n.payment.Name,n.isLock){n.isLoading=!1;return}p()});n.selectPayment=function(t){n.selectedPayment=t;n.createParams={Amount:""};t.AmountLock&&(n.createParams.Amount=t.RecommendationAmountSettings[0].Amount);n.amountValidate={errorMsg:null}};n.inputAmountChange=function(){var r=n.selectedPayment.Min,f=n.selectedPayment.Max,t=+n.createParams.Amount,i;(n.amountValidate.errorMsg=null,t||t==0)&&(/^[0-9]*$/.test(t)||(n.amountValidate.errorMsg=n.langs.OnlineDeposit_Error_DepositInteger),r!==null&&t<r&&(n.amountValidate.errorMsg=n.langs.OnlineDeposit_Error_DepositNumberAbove+": "+u("noFractionCurrency")(r,"",0)),f!==null&&t>f&&(n.amountValidate.errorMsg=n.langs.OnlineDeposit_Error_DepositNumberBelow+": "+u("noFractionCurrency")(f,"",0)),n.payment.Id===2&&(i=t*(n.PointCardFee.Percent/100),n.PointCardFee.FeeMax?i>n.PointCardFee.FeeMax?(n.actualDepositAmount=t-n.PointCardFee.FeeMax,n.depositFee=n.PointCardFee.FeeMax):(n.actualDepositAmount=t-i,n.depositFee=i):(n.actualDepositAmount=t-i,n.depositFee=i)))};n.submitCreate=function(){if(!n.amountValidate.errorMsg){var i={amount:n.createParams.Amount,settingId:n.selectedPayment.SettingId,paymentyType:n.payment.Id};n.sending=!0;t.post("/OnlineDeposit/Create_V2",i).then(function(n){for(var i=n.data,t=0;t<h.length;t++)if(h[t].type===i.ResultType){h[t].callback(i);return}})}};n.submitSend=function(){v(n.sendParams)}}]);app.controller("PromotionBetaCtrl",["$scope","$http","$sce","labelService",function(n,t,i,r){function u(t){var i={};if(t===""){$("#loading").html('<span><i class="fa fa-exclamation-circle" aria-hidden="true" style="margin-right:5px"><\/i>伺服器忙碌中，请洽客服人员<\/span>');return}i=t;n.categories=i;n.categories&&n.categories!=[]&&f()}function f(){$("#loading").css("display","none");var t=$.grep(n.categories,function(n){return n.isSelected});t.length==0&&angular.isObject(n.categories[0])&&(n.categories[0].isSelected=!0)}function e(n,i){var r=n===i;/^\<div data\-promotion\=\"loading\"/.test(n.PromotionContent)&&r&&t.get("/Promotion/GetDetail?PromotionId="+i.PromotionId+"").then(function(t){n.PromotionContent=t.data?t.data:'<div class="unload" style="width: 80%; margin: 20% auto;line-height: 50px;text-align: center;background-color:rgba(88,88,88,.5); background-color:#7f7f7f \\9;"><span><i class="fa fa-exclamation-circle" aria-hidden="true" style="margin-right:5px"><\/i>无优惠内容<\/span><\/div>'});n.isSelected=r?!n.isSelected:!1}n.toHtml=function(n){return i.trustAsHtml(n)};n.categoryClick=function(t){for(var i in n.categories)n.categories[i].isSelected=n.categories[i]==t;n.itemClick(null)};n.itemClick=function(t){var i,r;for(i in n.categories)for(r in n.categories[i].items)e(n.categories[i].items[r],t)};$("#un-lobby").append('<div id="loading" style="width: 800px;margin: 20px auto;line-height: 50px;text-align: center;background-color:rgba(255,255,255,.5); background-color:#7f7f7f \\9;"><i class="fa fa-spinner fa-spin" style="margin-right:5px"><\/i>'+(r.get("Common.Loading")||"载入中")+"<\/div>");u(JSON.parse(decodeURI(previewObj)))}]);app.controller("PromotionCtrl",["$scope","$http","$sce","$filter","labelService",function(n,t,i,r,u){function c(){t.post("/Promotion/GetList",{IsWeb:!0}).then(function(n){o(n.data)})}function o(t){var i={},r,f;if(t===""){$("#loading").html('<span><i class="fa fa-exclamation-circle" aria-hidden="true" style="margin-right:5px"><\/i>伺服器忙碌中，请洽客服人员<\/span>');return}if(i=JSON.parse(JSON.stringify(t)),e)n.categories=i;else{for(r in i)for(f in i[r].items)i[r].items[f].PromotionContent='<div data-promotion="loading" style="width: 80%;margin: 20% auto;line-height: 50px;text-align: center;background-color:rgba(88,88,88,.5); background-color:#7f7f7f \\9; color: #333;"><i class="fa fa-spinner fa-spin" style="margin-right:5px"><\/i>'+(u.get("Common.Loading")||"载入中")+"<\/div>";n.categories=i;i={}}n.categories&&n.categories!=[]&&l()}function l(){$("#loading").css("display","none");var t=$.grep(n.categories,function(n){return n.isSelected});t.length==0&&angular.isObject(n.categories[0])&&(n.categories[0].isSelected=!0)}function v(n,i){var u=n===i;/^\<div data\-promotion\=\"loading\"/.test(n.PromotionContent)&&u&&t.get("/Promotion/GetDetail?PromotionId="+i.PromotionId+"").then(function(t){n.PromotionContent=t.data?t.data.replace(/src=\"([^\"])+(png|jpg|gif)\"/g,function(n){return r("filterCdn")(n,"https://cdn2.weibo-hk.com/")}):'<div class="unload" style="width: 80%; margin: 20% auto;line-height: 50px;text-align: center;background-color:rgba(88,88,88,.5); background-color:#7f7f7f \\9;"><span><i class="fa fa-exclamation-circle" aria-hidden="true" style="margin-right:5px"><\/i>无优惠内容<\/span><\/div>'});n.isSelected=u?!n.isSelected:!1}var e=window.location.pathname.toLowerCase().indexOf("preview")>1,f,s,h;if($("#un-lobby").append('<div id="loading" style="width: 800px;margin: 20px auto;line-height: 50px;text-align: center;background-color:rgba(255,255,255,.5); background-color:#7f7f7f \\9;"><i class="fa fa-spinner fa-spin" style="margin-right:5px"><\/i>'+(u.get("Common.Loading")||"载入中")+"<\/div>"),e){f=_uccm2;window.addEventListener("message",a,!1);function a(n){n.origin==f?o(n.data):console.log("无法对应管端网域")}s=window.location.search;h=$('<iframe src="'+f+"/PromotionManagement/Preview"+s+'" style="display: none;"><\/iframe>');$("body").append(h)}else c();n.toHtml=function(n){return i.trustAsHtml(n)};n.categoryClick=function(t){for(var i in n.categories)n.categories[i].isSelected=n.categories[i]==t;n.itemClick(null)};n.itemClick=function(t){var i,r;for(i in n.categories)for(r in n.categories[i].items)v(n.categories[i].items[r],t)}}]);app.controller("QrCodeAuthenticationCtrl",["$scope","$window","authInfo",function(n,t,i){function r(t){for(var f=[{type:"login",image:i.LoginQrCode,url:i.LoginUrl},{type:"register",image:i.RegisterQrCode,url:i.RegisterUrl}],r=null,u=0;u<f.length;u++)f[u].type===t&&(r=f[u]);r&&(n.mainQrCode.type=r.type,n.mainQrCode.image=r.image,n.mainQrCode.url=r.url)}function u(n){t.open(n,"_blank")}n.authInfo=i;n.mainQrCode={type:i.LoginQrCode?"login":"register",image:i.LoginQrCode||i.RegisterQrCode,url:i.LoginUrl||i.RegisterUrl};n.switchDisplayQrCode=r;n.openDownloadLink=u}]);app.controller("RegisterAgreementCtrl",["$scope","$modalInstance",function(n,t){n.close=function(){t.close()}}]);app.controller("RegisterCtrl",["$scope","$window","$http","$modal","$q","$rootScope","$timeout","labelService","detectionRobotService","signalrService","CustomModalService","captchaService",function(n,t,i,r,u,f,e,o,s,h,c,l){function b(){n.bankAccountValidate={valid:!0,tip:""}}function d(n){setMaxDigits(129);var t=new RSAKeyPair(p,"",w);return encryptedString(t,n)}function k(t){var u,r;if(!p||!w){c.alert((o.get("Register.Different_Password")||"会员密码与确认密码不同")+".").then(function(){n.isProcessing=!1});return}u=["extend","stringify"],function(n,t){var i=function(t){while(--t)n.push(n.shift())};i(++t)}(u,307);var f=function(n){n=+n;return u[n]},a=JSON[f("0x0")](angular[f("0x1")](angular.extend({},t),angular[f("0x1")](y,{_c2:h.getConnectionId2()}))),e=encodeURIComponent(a),s=100,l=[];for(r=0;r<e.length;r+=s)l.push(d(e.substr(r,s)));h.invoke("a",l);i.post("/Register/Submit",t)}var a,y,p,w,v;h.connect();h.on("b",function(i){var u,s;if(i.IsNeCaptchaFailed){f.$broadcast("reInitNECaptcha"+a);return}if(f.$broadcast("closeCaptchaModal"+a),i.IsSuccess){if(setTimeout(function(){$("#btn-submit").focus()}),i.MemberRegisterVerifySwitch){var h=o.get("Register.RegisterVerifyDescription")||"您已完成注册手续，请在{0}分钟内洽客服开通帐号",l=o.get("Register.ContactCustomerService")||"联系客服",v=h.replace("{0}",i.AvailableMinutes)+'<br/><a href="javascript:void(0)" line-chat-click><i class="fas fa-headphones"><\/i> '+l+"<\/a>";c.alertError(v).then(function(){t.location.href="/"});return}for(u=0;u<i.Cookies.length;u++)document.cookie=i.Cookies[u];r.open({template:'<link href="/Content/Views/Register/SuccessDialog.css?version=20190419" rel="stylesheet" /><span class="btn-close" ng-click="close()"><\/span><div class="modal-rsd-content">    <p class="title">{{ langs.RegisterSuccess }}<\/p>    <p class="info" ng-if="showWithdraw">{{ langs.YouCan }} <span ng-click="withdraw()">{{ langs.BindBank }}<\/span>，{{ langs.WithdrawAnyTime }}!<\/p>    <div class="button-section">        <button class="btn-enter" ng-click="enter()" type="button">{{ langs.StartGame }}<\/button>        <button class="btn-deposit" ng-click="deposit()" type="button">{{ langs.DepositImmediately }}<\/button>    <\/div><\/div>',controller:"RegisterSuccessDialogCtrl",windowClass:"modal-rsd",resolve:{isBankAccount:function(){return!!n.params.BankAccount}}}).result.then(function(n){e(function(){t.location="/Register/Success?url="+n},400)},function(){e(function(){t.location="/Register/Success"},400)})}else s=i.ErrorMessage,c.alertError(s).then(function(){s&&s.indexOf("找不到此代理商")>=0&&$("#parentAccount").select().focus();n.params.checkCode=null;$("#checkcode-input-group input").focus()});n.isProcessing=!1});h.invoke("c");h.on("d",function(n){p=n.e;w=n.f});h.reconnected(function(){h.invoke("c");n.isProcessing&&c.alert((o.get("Register.Different_Password")||"会员密码与确认密码不同")+"..").then(function(){n.isProcessing=!1;n.params.checkCode=null;$("#checkcode-input-group input").focus()})});n.params={};n.agree=!0;n.isShowMore=!1;n.openAgreementClick=function(){var n=r.open({templateUrl:"/Register/Agreement",controller:"RegisterAgreementCtrl"})};n.$watch("params.Mobile",function(t,i){if(t){var r=new RegExp("^[0-9]+$").test(t);r||(n.params.Mobile=i)}});n.$watch("params.QQAccount",function(t,i){if(t){var r=new RegExp("^[0-9]+$").test(t);r||(n.params.QQAccount=i)}});i.post("/Register/GetAllBanks").then(function(t){n.banks=t.data;n.params.GroupBank=null});v=[{type:1,regx:/^[^\u4e00-\u9fa5]+$/,tip:o.get("Common.FormatTip_Chinese")||"请勿填入中文字"},{type:2,regx:/^[0-9]+$/,tip:o.get("Common.FormatTip_Number")||"格式不正确，请输入0到9之间的数字"},{type:3,regx:/(^[0-9]+$)|(\w+((-\w+)|(^\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$)/,tip:o.get("Common.FormatTip_NumberOrEmail")||"帐号格式不正确，请输入數字或Email格式"},{type:4,regx:/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/,tip:o.get("Common.FormatTip_Email")||"请输入信箱格式，例如:account@email.com"}];n.bankAccountValidate={valid:!0,tip:""};n.checkBankRequired=function(){var i=[n.params.GroupBank,n.params.BankAccount,n.params.BankProvince,n.params.BankCity],t;for(n.bankRequired=!1,t=0;t<i.length;t++)if(!!i[t]){n.bankRequired=!0;return}};n.checkBankAccountFormat=function(){var i,t,r;if(!n.params.GroupBank||!n.params.BankAccount){b();return}for(t=0;t<v.length;t++)v[t].type===n.params.GroupBank.AccountFormat&&(i=v[t]);r=new RegExp(i.regx).test(n.params.BankAccount);n.bankAccountValidate.valid=r;n.bankAccountValidate.tip=r?"":i.tip};n.changeGroupBank=function(){b();n.params.BankAccount="";n.checkBankRequired()};n.register=function(t){var r=new RegExp("^[A-Za-z][A-Za-z_0-9]{1,14}$").test(n.params.Account),u=new RegExp("^(?=.*[a-zA-Z])(?=.*[0-9]).{6,}$").test(t.Password),i;if(!r){c.alert(o.get("Register.Account_Error")||"会员帐号格式错误");return}if(!u){c.alert(o.get("Register.Password_Error")||"会员密码格式错误，至少 6 个字符以上，须包含字母及数字");return}if(n.Confirm_Password!=t.Password){c.alert(o.get("Register.Different_Password")||"会员密码与确认密码不同");return}if(n.params.Birthday&&(i=/^\d{4}\/\d{2}\/\d{2}$/g,!i.test(n.params.Birthday))){c.alert(o.get("Register.Birthday_Error")||"出生日期格式错误");return}if(!n.bankAccountValidate.valid){$('input[ng-model="scope.params.BankAccount"]').focus();return}if(!n.agree){c.alert(o.get("Register.Not_Agree")||"未同意用户注册协议");return}if(!n.checkCode){c.alert(o.get("Register.Empty_Checkcode")||"验证码为空, 请取得验证码");return}t.checkCodeEncrypt=n.checkCode.encrypt;t.BankName=n.params.GroupBank?n.params.GroupBank.Name:null;n.isProcessing=!0;s.detectionRobot(t,n.registerSetting).then(function(){a=l.verifyViaDialogForRegister();a?n.$on("validateNECaptcha"+a,function(n,i){t.neCaptcha=i;k(t)}):k(t)},function(t){n.params.checkCode=null;$("#checkcode-input-group input").focus();n.isProcessing=!1;c.alert(t||"注册程序验证失败")})};n.moreOptionClick=function(){n.isShowMore=!0};n.closeMarquee=function(){n.isMarqueeShowClass=!1};n.scope=n;i.post("/Register/GetRegisterSetting").then(function(t){var r=t.data,u,i;if(r.IsSuccess===!1){c.alertError(r.ErrorMessage);return}n.registerSetting=r;n.state="ok";u=["input[required]","length","keydown","which","keyCode","indexOf","form[ng-submit='register(params)']","find"],function(n,t){var i=function(t){while(--t)n.push(n.shift())};i(++t)}(u,270);i=function(n){n=+n;return u[n]};setTimeout(function(){var n=$(i("0x0"))[i("0x1")](i("0x2")),t;y={_r:n[i("0x3")],_k:0};t=[9,13,16,17,18,91];n.on(i("0x4"),function(n){var r=n[i("0x5")]||n[i("0x6")];t[i("0x7")](r)<0&&y._k++})},0)});n.hasOptional=function(){var t,i,r,u;for(t in n.registerSetting)if((i=t.indexOf("IsShow_"),!(i<0))&&(r=n.registerSetting[t],r!=!1)&&(u=n.registerSetting["IsRequired_"+t.split("_")[1]],u==!1))return!0;return!1}}]);app.controller("RegisterSuccessDialogCtrl",["$scope","$modalInstance","$document","isBankAccount","LobbyNavService","labelService","_env",function(n,t,i,r,u,f,e){function o(){t.dismiss()}function s(n){t.close(n)}var h=e.RegisterSuccessDialogCtrl?e.RegisterSuccessDialogCtrl.CategoryKey||74:74;n.langs=f.get("Register");n.showWithdraw=!r;n.close=function(){o()};n.enter=function(){var n="/Lobby/RecommendGame?CategoryKey="+h;u.openLobbyNav(n,"RecommendList");o()};n.deposit=function(){s("/Deposit")};n.withdraw=function(){s("/WithdrawApplication")};i.on("keydown",function(n){switch(n.keyCode){case 13:o();break;case 27:o()}});n.$on("$destroy",function(){i.off("keydown")})}]);app.controller("SiteMailCountCtrl",["$scope","$http","DataService",function(n,t,i){n.MailIsReadCount=i.getValue();t.post("/SiteMail/GetUnreadMailCount").then(function(n){n.data.Count>0&&i.setValue(n.data.Count)})}]);app.controller("SiteMailCtrl",["$scope","$http","$window","$modal","$timeout","bodyScrollService","DataService","labelService","CustomModalService",function(n,t,i,r,u,f,e,o,s){function b(){n.unRead=e.getValue();t.post("/SiteMail/GetUnreadMailCount").then(function(n){n.data.Count>0&&e.setValue(n.data.Count)})}function k(){h.inbox&&n.mailbox=="inbox"||h.sentbox&&n.mailbox=="sentbox"||h.promotionbox&&n.mailbox=="promotionbox"||f.getDistanceOfBottom()>1e3||(n.mailbox=="inbox"?v():n.mailbox=="sentbox"?y():n.mailbox=="promotionbox"&&p())}function v(){h.inbox=d().then(function(n){return tt(n)})}function y(){h.sentbox=g().then(function(n){return it(n)})}function p(){h.promotionbox=nt().then(function(n){return rt(n)})}function d(){return t.post("/SiteMail/GetInboxList",{Size:c,LastId:n.getInboxListMinId}).then(function(n){return n.data})}function g(){return t.post("/SiteMail/GetSentboxList",{Size:c,LastId:n.getSentboxListMinId}).then(function(n){return n.data})}function nt(){return t.post("AnnouncementSiteMail/GetList",{Size:c,LastId:n.getPromotionboxListMinId}).then(function(n){return n.data})}function tt(t){(n.getInboxListMinId=t.LastId,t.InboxMailList.length>0&&(n.mailList.inbox=n.mailList.inbox.concat(t.InboxMailList)),t.InboxMailList.length<c&&(n.isFinish.inbox=!0,a()),n.isFinish.inbox)||(h.inbox=null)}function it(t){(n.getSentboxListMinId=t.LastId,t.SentboxMailList.length>0&&(n.mailList.sentbox=n.mailList.sentbox.concat(t.SentboxMailList)),t.SentboxMailList.length<c&&(n.isFinish.sentbox=!0,a()),n.isFinish.sentbox)||(h.sentbox=null)}function rt(t){(n.getPromotionboxListMinId=t.LastId,t.MailList.length>0&&(n.mailList.promotionbox=n.mailList.promotionbox.concat(t.MailList)),t.MailList.length<c&&(n.isFinish.promotionbox=!0,a()),n.isFinish.promotionbox)||(h.promotionbox=null)}function ut(t){return $.map($.grep(n.mailList[t],function(n){return n.isSelected}),function(n){return n.Id})}function a(){n.isFinish.inbox&&n.isFinish.sentbox&&n.isFinish.promotionbox&&$(window).off("scroll")}function w(){n.editing&&(CKEDITOR.instances.replyEditor.removeAllListeners(),CKEDITOR.remove(CKEDITOR.instances.replyEditor));n.editing=!1;n.detailMail={}}var c,h,l;n.mailbox="promotionbox";c=100;h={inbox:null,sentbox:null,promotionbox:null};n.mailList={inbox:[],sentbox:[],promotionbox:[]};n.isFinish={inbox:!1,sentbox:!1,promotionbox:!1};n.isAllSelected={inbox:!1,sentbox:!1};l={language:"zh-cn",height:"350",allowedContent:!0,removePlugins:"uploadimage",basicEntities:!1,toolbarGroups:[{name:"clipboard",groups:["clipboard","undo"]},{name:"basicstyles",groups:["basicstyles"]},{name:"paragraph",groups:["list","indent","blocks","align"]},{name:"links",groups:["links"]},{name:"insert",groups:["insert"]},{name:"styles",groups:["styles"]},{name:"colors",groups:["colors"]},{name:"tools",groups:["tools"]},{name:"others",groups:["others"]}],removeButtons:"PasteFromWord,Superscript,Subscript,CreateDiv,Image,Flash,Smiley,SpecialChar,PageBreak,Anchor,Iframe,Styles,Format,ShowBlocks"};v();y();p();b();$(window).scroll(function(){k()});n.allSelect=function(t){$.each(n.mailList[t],function(i,r){r.isSelected=n.isAllSelected[t]})};n.mailSelect=function(t){var i=!1;angular.forEach(n.mailList[t],function(n){n.isSelected||(i=!0)});n.isAllSelected[t]=!i};n.delMail=function(i){function u(){var n={};return i=="inbox"?(n={inboxMailIds:r},t.post("/SiteMail/DeleteInboxMails",n).then(function(n){return n.data})):i=="sentbox"?(n={sentboxMailIds:r},t.post("/SiteMail/DeleteSentboxMails",n).then(function(n){return n.data})):void 0}function f(n){n.IsSuccess||s.alertError(n.ErrorMessage)}var r=ut(i);s.confirm(o.get("SiteMail.BatchConfirmDel")+n.countSelected(i)+o.get("SiteMail.BatchDelLetter")).then(function(t){var h,o,s;if(t){for(h=0,o=0;o<n.mailList[i].length;o++)for(s=0;s<r.length;s++)n.mailList[i][o].Id==r[s]&&(n.mailList[i][o].IsRead===!1&&h++,n.mailList[i].splice(o,1));e.setValue(n.unRead.Count-h);u().then(function(n){return f(n)})}})};n.countSelected=function(t){return n.mailList[t].length?n.mailList[t].filter(function(n){return n.isSelected}).length:0};n.markReadState=function(i){for(var f,r=$.map($.grep(n.mailList.inbox,function(n){return i?n.isSelected&&!n.IsRead:n.isSelected&&n.IsRead}),function(n){return n.Id}),u=0;u<n.mailList.inbox.length;u++)for(f=0;f<r.length;f++)n.mailList.inbox[u].Id==r[f]&&(n.mailList.inbox[u].IsRead=i);(i?e.setValue(parseInt(n.unRead.Count)-r.length):e.setValue(parseInt(n.unRead.Count)+r.length),r.length)&&t.post("/SiteMail/SetInboxMailsAsReadOrUnread",{inboxMailIds:r,isRead:i}).then(function(n){n.data.IsSuccess||s.alertError(n.data.ErrorMessage)})};n.openNewMail=function(){r.open({templateUrl:"newMailModal",scope:n,controller:["$modalInstance","$scope","$timeout","$http",function(n,t,i,r){t.close=n.close;t.focusOnOpen={};i(function(){l.startupFocus=!1;CKEDITOR.replace("newMail",l);t.focusOnOpen.focus("subject")});t.sentMail=function(){var n=CKEDITOR.instances.newMail.getData(),i;if(!n){s.alert(o.get("SiteMail.ContentEmpty")||"信息内容不能为空白");return}if(n.length>2e3){s.alert(o.get("SiteMail.ContentOver")||"内容超过限定字数");return}t.isprocess=!0;i={Subject:t.subject,MailBody:n};r.post("/SiteMail/SendMail",i).then(function(n){if(t.isProcess=!1,!n.data.IsSuccess){s.alertError(n.data.ErrorMessage).then(function(){t.close()});return}t.mailList.sentbox.unshift({Id:n.data.Id,MailId:n.data.MailId,Subject:n.data.Subject,MailBodyPreview:n.data.MailBodyPreview,SendDate:n.data.SendDate});s.alert(o.get("SiteMail.SendSuccess")||"您的信件已送出").then(function(){t.close();t.subject="";CKEDITOR.instances.newMail.setData("")})})}}]})};n.openMail=function(i){r.open({templateUrl:"detailMailModal",scope:n,controller:["$scope","$modalInstance",function(n,i){n.close=function(){w();i.close()};n.editStart=function(){n.editing=!0;n.replySubject="RE:"+n.detailMail.Subject;l.startupFocus=!0;CKEDITOR.replace("replyEditor",l);CKEDITOR.instances.replyEditor.setData('<p><\/p><blockquote><div style="color:#777;font-style: normal;">系统 于 '+moment(n.detailMail.SendDate).format("YYYY/MM/DD (dd) HH:mm")+"寄出<\/div><div>"+n.detailMail.detail+"<\/div><\/blockquote>")};n.replyMail=function(){var i=CKEDITOR.instances.replyEditor.getData(),r;if(!i){s.alert(o.get("SiteMail.ContentEmpty")||"信息内容不能为空白");return}if(n.replySubject.length>50){s.alert(o.get("SiteMail.SubjectOver")||"主旨超过限定字数");return}if(i.length>2e3){s.alert(o.get("SiteMail.ContentOver")||"内容超过限定字数");return}n.replying=!0;r={Subject:n.replySubject,MailBody:i};t.post("/SiteMail/SendMail",r).then(function(t){if(n.replying=!1,!t.data.IsSuccess){s.alertError(t.data.ErrorMessage).then(function(){n.close()});return}n.mailList.sentbox.unshift({Id:t.data.Id,MailId:t.data.MailId,Subject:t.data.Subject,MailBodyPreview:t.data.MailBodyPreview,SendDate:t.data.SendDate});s.alert(o.get("SiteMail.Replyed")||"您的信件已回复").then(function(){n.close()})})};n.delDetail=function(i){function r(){var r={};return i=="inbox"?(r={inboxMailIds:n.detailMail.Id},t.post("/SiteMail/DeleteInboxMails",r).then(function(n){return n.data})):i=="sentbox"?(r={sentboxMailIds:n.detailMail.Id},t.post("/SiteMail/DeleteSentboxMails",r).then(function(n){return n.data})):void 0}function u(n){if(!n.IsSuccess){s.alertError(n.ErrorMessage);return}}s.confirm(o.get("SiteMail.ConfirmDel")||"确定要删除此信件？").then(function(t){t&&(r().then(function(n){return u(n,i)}),angular.forEach(n.mailList[i],function(t,r){t.Id==n.detailMail.Id&&n.mailList[i].splice(r,1)}),n.close())})}}]}).result.then(function(){},function(){w()});n.detailLoading=!0;n.detailMail=i;n.detailMail.IsRead===!1&&(n.unRead.Count--,e.setValue(n.unRead.Count),angular.forEach(n.mailList.inbox,function(t){t.Id==n.detailMail.Id&&(t.IsRead=!0)}),t.post("/SiteMail/SetInboxMailsAsReadOrUnread",{inboxMailIds:n.detailMail.Id,isRead:!0}).then(function(n){n.data.IsSuccess||s.alertError(n.data.ErrorMessage)}));n.mailbox!=="promotionbox"?t.post("/SiteMail/GetMailDetail",{mailId:n.detailMail.MailId}).then(function(t){n.detailLoading=!1;t.data.IsSuccess||s.alertError(t.data.ErrorMessage);n.detailMail.detail=t.data.MailDetail.MailBody}):(n.detailLoading=!1,n.detailMail.detail=n.detailMail.MailBody)}}]);app.controller("StationMailCountCtrl",["$scope","$http","DataService",function(n,t,i){n.MailIsReadCount=i.getValue();t.post("/SiteMail/GetUnreadMailCount").then(function(n){n.data.Count>0&&i.setValue(n.data.Count)})}]);app.controller("StationMailCtrl",["$scope","$http","$window","$modal","$timeout","bodyScrollService","signalrService","DataService",function(n,t,i,r,u,f,e){function h(){$(window).off("scroll")}function o(){if(!s&&!(f.getDistanceOfBottom()>1e3)){if(!n.isScroll){n.pageIndex=0;return}s=t.post("/StationMail/GetMailList",{pageIndex:n.pageIndex}).then(function(t){var r=t.data,f;if(n.loading=!1,n.pageIndex=n.pageIndex+1,r.IsSuccess===!1){i.alert(r.ErrorMessage);return}if(r.total===0){n.showview="nothing";return}if(n.pageIndex==r.pageCount&&(n.isScroll=!1,h()),n.showview="getlist",n.mailParams.Total=r.total,n.mailParams.PageCount=r.pageCount,n.pageIndex==0)n.loading=!1,n.getMailList=angular.copy(r.mailData);else for(f in r.mailData)n.getMailList.push(r.mailData[f]);s=null;u(o)})}}n.loading=!0;n.getMailList=[];n.mailParams={};n.isScroll=!0;n.pageIndex=0;var s;$(window).scroll(function(){f.getDistanceOfBottom()<90&&o(n.pageIndex)});$(document).on("scroll",o);o();n.goDetail=function(n){i.location.href="/StationMail/Detail/"+n};n.openNewMail=function(){r.open({templateUrl:"/StationMail/WriteMailDialog",controller:"StationMailWriteDialogCtrl"})};e.on("GetMailList_New",function(t){var i=$.grep(n.getMailList,function(n){return n.Id==t.Id}).length>0;if(!i){if(n.getMailList.length>=0){n.getMailList.splice(0,0,t);return}o(n.pageIndex)}});e.on("GetMailListIsRead",function(t){var r=$.grep(n.getMailList,function(n){return n.Id==t.mailId}),i;r.length!=0&&(i=r[0],i.IsRead=t.isRead,i.UpdateTime=t.UpdateTime)})}]);app.controller("StationMailDetailCtrl",["$scope","$http","$window","$timeout","signalrService","DataService",function(n,t,i,r,u,f){n.mailSubjectParams={};n.reply={mailId:$("#mailId").text(),IsMember:!0,ReplierAccount:"您",ReplyTime:null,connectionId:null};n.replyParams=[];n.loading=!0;n.enterCheck=!0;n.error=!0;n.replyStatus=!1;n.enterChange=function(n){if($textarea=$("#replyMsg"),$textarea.off("keypress").focus(),n.enterCheck)$textarea.focus().on("keypress",function(n){if(n.keyCode==13&&!n.shiftKey)return $("#submit").click(),n.preventDefault(),!1})};n.getMailDetail=function(){t.post("/StationMail/SetMailIsRead",{mailId:$("#mailId").text()});t.post("/StationMail/GetMailDetial",{id:$("#mailId").text()}).then(function(t){var i=t.data;if(n.loading=!1,i.IsSuccess===!1){n.error=!1;return}f.setValue(i.UnreadCount);n.mailSubjectParams=i;r(function(){n.enterChange(n)})})};n.getMailDetail();n.submit=function(){var i=n.replyParams.push(angular.copy(n.reply))-1;n.replyParams[i].replyStatus=!0;t.post("/StationMail/CreateReply",n.reply).then(function(t){var r=t.data;if(r.IsSuccess==!1){n.replyParams[i].addReplyErr=!0;n.replyParams[i].errorMsg=r.ErrorMessage;n.reply.ReplyContent=null;return}n.replyParams[i].replyStatus=!1;n.reply.ReplyTime=r.Datetime;n.mailSubjectParams.ReplyData.push(angular.copy(n.reply));n.reply.ReplyContent=null})};n.isReply=function(i){t.post("/StationMail/CreateReply",n.replyParams[i]).then(function(t){var r=t.data;if(r.IsSuccess==!1){n.replyParams[i].errorMsg=r.ErrorMessage;return}n.replyParams[i].replyStatus=!1;n.replyParams[i].ReplyTime=r.Datetime;n.getMailDetail.ReplyData.push(angular.copy(n.replyParams[i]))})};n.isEdit=function(t){n.replyParams[t].isEditStatus=!n.replyParams[t].isEditStatus};n.isCanel=function(t){n.replyParams[t].replyStatus=!1};u.on("ReplyContent",function(i){$("#mailId").text()==i.mailId&&(n.mailSubjectParams.ReplyData.push(i.replyContent),t.post("/StationMail/SetMailIsRead",{mailId:i.mailId}))})}]);app.controller("StationMailGroupCtrl",["$scope","$http","$window","$modal","$timeout","$location","bodyScrollService","signalrService","DataService",function(n,t,i,r,u,f,e,o){function l(){$(window).off("scroll")}function s(){if(!c&&!(e.getDistanceOfBottom()>1e3)){if(!n.isScroll){n.pageIndex=0;return}c=t.post("/StationMailGroup/GetMailList",{pageIndex:n.pageIndex}).success(function(t){if(n.loading=!1,n.pageIndex=n.pageIndex+1,t.isSuccess===!1){i.alert(t.errorMessage);return}if(t.total===0){n.showview="nothing";return}if(n.pageIndex==t.pageCount&&(n.isScroll=!1,l()),n.showview="getlist",n.mailParams.Total=t.total,n.mailParams.PageCount=t.pageCount,n.pageIndex==0)n.loading=!1,n.mailList=angular.copy(t.mailData);else for(var r in t.mailData)n.mailList.push(t.mailData[r]);c=null;u(s)})}}var h,c;n.loading=!0;h=!1;n.mailList=[];n.mailParams={};n.isScroll=!0;n.pageIndex=0;$(window).scroll(function(){e.getDistanceOfBottom()<90&&s(n.pageIndex)});$(document).on("scroll",s);s();n.goDetail=function(n){i.location.href="/StationMailGroup/Detail/"+n};n.openNewMail=function(){r.open({templateUrl:"/StationMailGroup/WriteMailDialog",controller:"StationMailGroupWriteDialogCtrl"})};o.on("GetMailList_New",function(t){if(h){var i=$.grep(n.mailList,function(n){return n.SubjectId==t.SubjectId}).length>0;if(!i){if(n.mailList.length>=0){n.mailList.splice(0,0,t);return}s(n.pageIndex)}}});o.on("GetMailListIsRead",function(t){var i,r;h&&(i=$.grep(n.mailList,function(n){return n.SubjectId==t.SubjectId}),i.length!=0)&&(r=i[0],r.IsRead=t.isRead,r.UpdateTime=t.UpdateTime)})}]);app.controller("StationMailGroupDetailCtrl",["$scope","$http","$window","$timeout","$location","signalrService","DataService",function(n,t,i,r,u,f,e){function s(){var r,i;n.reply.ReplyTime=n.meiDonNow;r=angular.copy(n.reply);n.replyParams.push(r);i=n.replyParams[n.replyParams.length-1];i.replyStatus=!0;t.post("/StationMailGroup/CreateReply",n.reply).then(function(t){var u=t.data;if(u.isSuccess==!1){i.addReplyErr=!0;i.errorMsg=c(u.errorMessage);n.reply.ReplyContent=null;return}n.isAntiReply=!1;i.replyStatus=!1;n.reply.ReplyTime=u.datetime;r.ReplyTime=u.datetime;n.mailSubjectParams.ReplyData.push(r);n.reply.ReplyContent=null})}function a(){n.isNoticeLetter?t.post("/StationMailGroup/CreateMail",{Subject:"RE: "+n.mailSubjectParams.Subject,Content:n.reply.ReplyContent}).then(function(n){var t=n.data;if(t.isSuccess==!1){i.alert(t.errorMessage);return}i.alert("您的信件已回复");i.location="/StationMailGroup/Detail/"+t.SubjectId}):s()}function h(t){t&&(n.needToMailList=!0,n.totalErrorMessage="该信件无法回复")}function c(t){var i=t.replace(o,"");return o.test(t)&&(n.replyParams.pop(),h(!0)),i}var o=new RegExp("__RETURNTOMAILLIST__","g"),l=!1;n.isAntiReply=!1;n.replyFromKey=!1;n.originMailContent=null;n.subjectId=parseInt(window.location.pathname.split("/").reverse()[0]);n.mailSubjectParams={};n.reply={mailId:null,IsMember:!0,ReplierAccount:"您",ReplyTime:null,connectionId:null,ReplyContent:null};n.replyParams=[];n.loading=!0;n.enterCheck=!0;n.error=!0;n.replyStatus=!1;n.needToMailList=!1;n.totalErrorMessage="";n.isNoticeLetter=!1;n.enterChange=function(n){if($textarea=$("#replyMsg"),$textarea.off("keypress").focus(),n.enterCheck)$textarea.focus().on("keypress",function(n){if(n.keyCode==13&&!n.shiftKey)return $("#submit").click(),n.preventDefault(),!1})};n.getMailDetail=function(){t.post("/StationMailGroup/GetMailDetial",{subjectId:n.subjectId}).then(function(t){var i=t.data;if(i.isSuccess===!1){n.error=!1;return}e.setValue(i.UnreadCount);n.mailSubjectParams=i;n.isNoticeLetter=n.mailSubjectParams.MemberCount>1;h(n.mailSubjectParams.IsDisable);r(function(){n.enterChange(n)});n.reply.mailId=i.FirstStationMailId;n.loading=!1})};n.getMailDetail();n.submit=function(){n.isAntiReply||(n.isAntiReply=!0,n.mailSubjectParams.IsMember?s():a())};n.isReply=function(i){t.post("/StationMailGroup/CreateReply",n.replyParams[i]).then(function(t){var r=t.data;if(r.isSuccess==!1){n.replyParams[i].errorMsg=c(r.errorMessage);return}n.replyParams[i].replyStatus=!1;n.replyParams[i].ReplyTime=r.datetime;n.getMailDetail.ReplyData.push(angular.copy(n.replyParams[i]))})};n.isEdit=function(t){n.replyParams[t].isEditStatus=!n.replyParams[t].isEditStatus};n.isCanel=function(t){n.replyParams[t].replyStatus=!1};f.on("ReplyContent",function(i){if(l){var r=!1;n.subjectId==i.SubjectId&&(angular.forEach(n.mailSubjectParams.ReplyData,function(n){i.replyContent.Id===n.Id&&(r=!0)}),r||(n.mailSubjectParams.ReplyData.push(i.replyContent),t.post("/StationMailGroup/SetMailIsRead",{subjectId:i.SubjectId})))}})}]);app.controller("StationMailGroupWriteDialogCtrl",["$scope","$http","$window","$modalInstance",function(n,t,i,r){n._focusOn={};n._focusOn.target="Subject";n.isProcess=!1;n.close=r.close;n.applyMail=function(r){var u={Subject:r.Subject||"",Content:r.Content||""};if(u.Content===""&&i.confirm("信息内容为空白，确定送出吗？")==!1){n.isProcess=!1;return}n.isProcess=!0;u.Subject&&u.Subject!==""&&u.Content&&u.Content!==""&&t.post("/StationMailGroup/CreateMail",u).then(function(t){var r=t.data;if(n.isProcess=!1,r.isSuccess==!1){i.alert(r.errorMessage);return}i.alert("您的信件已送出");n.close()})}}]);app.controller("StationMailWriteDialogCtrl",["$scope","$http","$window","$modalInstance",function(n,t,i,r){n._focusOn={};n._focusOn.target="Subject";n.isProcess=!1;n.close=r.close;n.applyMail=function(r){if(!r.Content&&i.confirm("信息内容为空白，确定送出吗？")==!1){n.isProcess=!1;return}n.isProcess=!0;t.post("/StationMail/CreateMail",r).then(function(t){var r=t.data;if(n.isProcess=!1,r.IsSuccess==!1){i.alert(r.ErrorMessage);return}i.alert("您的信件已送出");n.close()})}}]);app.controller("TransactionCtrl",["$scope","$http","$modal","MeidonTimeService",function(n,t,i,r){function f(t){u.count=40;u.timeBegin=e(t);n.records=[];n.complete=!1;n.isProcessing=!1;n.state="";n.loadMore()}function e(n){var t=r.getCurrentMeidon();return t.subtract(n,"days").format("YYYY/MM/DD")}var u={};n.selectedBtn=0;n.openDetailDialog=function(n){var t=i.open({templateUrl:"/Transaction/DetailDialog",controller:"TransactionDetailDialogCtrl",resolve:{id:function(){return n}}})};n.loadMore=function(){n.complete||n.isProcessing||(n.isProcessing=!0,u.skip=n.records.length,t.post("/Transaction/Search",u).then(function(t){var i=t.data;n.isProcessing=null;angular.forEach(i.records,function(t){n.records.push(t)});i.records&&i.records.length<u.count&&(n.complete=!0);n.state="ok"}))};n.changeTimeBegin=function(n,t){u.timeEnd=angular.isUndefined(t)?null:e(t);f(n)};t.post("/Transaction/GetSelectItem").then(function(t){var i=t.data;n.selectItems=i.selectItem;n.select=n.selectItems[0]});n.searchType=function(t){n.complete=!1;n.records=[];u.SearchType=t.SelectValue;n.loadMore()};f(0)}]);app.controller("TransactionDetailDialogCtrl",["$scope","$http","$window","$modalInstance","id","CustomModalService",function(n,t,i,r,u,f){n.loading=!0;t.post("/Transaction/GetDetail",{id:u}).then(function(t){var i=t.data;if(!i.IsSuccess){f.alertError(i.ErrorMessage).then(function(){r.close()});return}n.tran=i.Transaction;n.loading=null});n.close=function(){r.close()}}]);app.controller("TransferCtrl",["$scope","$http","$filter","$window","CustomModalService",function(n,t,i,r,u){t.post("/Transaction/TransferInit").then(function(t){var i=t.data;n.balance=i.balance;n.complete=!0});n.submit=function(){if(n.balance-n.money<0){u.alert("余额不足");return}var f=i("customCurrency"),e="转出帐号　："+n.account+"\r金额　　　："+f(n.money)+"\r转帐後余额："+f(n.balance-n.money)+"\r\r确定转帐?";u.confirm(e).then(function(i){if(i){var f={receiveMemberAccount:n.account,money:n.money,moneyPassword:n.password};n.isProcessing=!0;t.post("/Transaction/TransferSubmit",f).then(function(t){var i=t.data;n.isProcessing=null;i.IsSuccess?u.alert("转帐成功").then(function(){r.location.href="/"}):u.alertError(i.ErrorMessage)})}})}}]);app.controller("TrialCtrl",["$scope","$http","$window","$location","CustomModalService",function(n,t,i,r,u){function f(){t.post("/Trial/IsAutoVerifyMemberTrial").then(function(t){n.isLoading=!1;n.isAutoVerify=t.data.isAuto})}function e(n){return/^[0-9]*$/.test(n)}n.isLoading=!0;n.isAutoVerify=!1;n.params={};f();n.apply=function(r){if(!e(r.params.mobile)){u.alert("手机号请输入数字").then(function(){$("#mobile").focus()});return}n.params.checkCodeEncrypt=r.checkCode.encrypt;t.post("/Trial/ApplySubmit",n.params).then(function(t){var r=t.data;if(r.IsSuccess===!1){u.alertError(r.ErrorMessage).then(function(){n.params.checkCode=null;n.checkCode=null;$('input[name="checkCode"]').focus()});return}u.alert("试玩帐号申请成功，请联络在线客服索取").then(function(){i.location.href="/Trial/Login"})})};n.login=function(n){t.post("/Trial/LoginSubmit",n.params).then(function(n){var t=n.data;if(t.IsSuccess===!1){u.alertError(t.ErrorMessage);return}i.location.href="/"})};n.autoLogin=function(r){n.params.checkCodeEncrypt=r.checkCode.encrypt;t.post("/Trial/AutoSubmit",n.params).then(function(t){var r=t.data;if(r.IsSuccess===!1){u.alertError(r.ErrorMessage).then(function(){n.params.checkCode=null;$('input[name="checkCode"]').focus()});return}i.location.href="/"})}}]);app.controller("WalletAdministrationFeeDialogCtrl",["$scope","$http","$window","$modalInstance",function(n,t,i,r){n.showView="loadData";t.post("/WithdrawApplication/AdministrationDetail").then(function(t){var i=t.data;n.records=i;n.records.length==0?n.showView="noData":(n.showView="getData",n.total=0,angular.forEach(i,function(t){t&&t.IsAudit===!1&&t.Amount&&(n.total+=t.Amount)}))});n.close=r.close}]);app.controller("WalletRemittanceCtrl",["$scope","$http","$q","MeidonTimeService","FunctionSwitchService",function(n,t,i,r,u){function f(){var n=$(".body.container #title"),t=document.createElement("style");t.type="text/css";t.innerHTML=".custom-wallet-color { color: "+n.css("color")+" }.custom-wallet-bg { background-color: "+n.css("background-color")+"}.custom-wallet-border-color { border-color:"+n.css("background-color")+"}.custom-wallet-color-r { color: "+n.css("background-color")+" }";document.body.appendChild(t)}n.isLoading=!0;n.isEnable=!1;n.walletPage="withdraw";f();i.all([u.getFunctionSwitch(),t.post("/WalletRemittance/GetAppUrlQRCode")]).then(function(t){n.isEnable=t[0].WalletRemittanceSwitch;n.andriodAppUrlQRCode=t[1].data.AndriodAppUrlQRCode;n.iosAppUrlQRCode=t[1].data.IosAppUrlQRCode;n.isLoading=!1})}]);app.controller("WalletRemittanceDepositCtrl",["$scope","$http","$modal","$filter","CustomModalService","languageService","FunctionSwitchService",function(n,t,i,r,u,f,e){function s(){t.post("/WalletRemittance/GetDepositInfo").then(function(t){var i=t.data;if(n.loading=!1,n.isSuccess=i.IsSuccess,n.depositEnabled=i.DepositEnabled,!i.IsSuccess){n.errorMsg=i.ErrorMessage;return}if(!i.DepositEnabled){n.closeMessage=i.DepositCloseMessage;return}n.min=i.DepositMin||1;n.max=i.DepositMax;n.placeholder=h(i.DepositMin,i.DepositMax)});f.getMultilingual(["WalletRemittance"]).then(function(n){o=n.data})}function h(n,t){return n!=null&&t!=null?r("number")(n)+" ~ "+r("number")(t):n!=null&&t==null?r("number")(n)+" "+(o.WalletRemittance_More||"以上"):n==null&&t!=null?r("number")(t)+" "+(o.WalletRemittance_Less||"以下"):o.WalletRemittance_Unlimited||"未限制"}function c(n){var t='<div class="modal-header"><h3>'+(o.WalletRemittance_DepositInfo||"付款资讯")+'<\/h3><\/div><div class="modal-body"><img src="data:image/jpeg;base64,'+n+'" /><p><span ng-bind="tip"><\/span><\/p><\/div><div class="modal-footer"><button class="btn" ng-click="ok()">'+(o.WalletRemittance_Closed||"关闭")+"<\/button><\/div>";i.open({template:t,controller:["$scope","$modalInstance","$interval","$timeout","$window","labelService",function(n,t,i,r,u,f){var e=180,o=e,h=f.get("WalletRemittance.TimeoutClose")||"视窗将在 {0} 秒后自行关闭",s;n.ok=function(){t.close();r(function(){u.location.href="/WalletRemittance"},400)};s=i(function(){n.tip=h.replace("{0}",o);o--},1e3);r(function(){i.cancel(s);n.ok()},1e3*(e+1))}],windowClass:"qr-modal",backdrop:"static",keyboard:!1})}var o;n.isEnable=!1;n.loading=!0;n.applyProcessing=!1;e.getFunctionSwitch().then(function(t){(n.isEnable=t.WalletRemittanceSwitch,n.isEnable)&&s()});n.apply=function(i){n.applyProcessing=!0;t.post("/WalletRemittance/SubmitDeposit",{Amount:i.depositAmount}).then(function(t){var i=t.data;if(n.applyProcessing=!1,!i.IsSuccess){u.alertError(i.ErrorMessage);return}c(i.Qrcode)})}}]);app.controller("WalletRemittanceWithdrawApplicationCtrl",["$scope","$http","$filter","$modal","CustomModalService","labelService","languageService","FunctionSwitchService",function(n,t,i,r,u,f,e,o){function v(){t.post("/WalletRemittance/GetWithdrawApplicationInfo",null).then(function(t){var i=t.data;if(n.isLoading=!1,i.IsSuccess===!1){n.errorMsg=i.ErrorMessage;return}return n.isSuccess=!0,n.withdrawInfo=i,e.getMultilingual(["WalletRemittance"])}).then(function(t){s=t.data;n.withdrawInfo.NoBank||a(n.withdrawInfo.WithdrawMin,n.withdrawInfo.WithdrawMax)})}function a(t,r){var t=t!==null?i("customCurrency")(t):null,r=r!==null?i("customCurrency")(r):null;n.withdrawPlaceholder=t!==null&&r!==null?t+" ~ "+r:t!==null?t+" "+s.WalletRemittance_More:r!==null?r+" "+s.WalletRemittance_Less:s.WalletRemittance_Unlimited}function y(n){var t='<div class="modal-header"><h3>'+(s.WalletRemittance_WithdrawApplicationInfo||"提现资讯")+'<\/h3><\/div><div class="modal-body"><img src="data:image/jpeg;base64,'+n+'" /><p><span ng-bind="tip"><\/span><\/p><\/div><div class="modal-footer"><button class="btn" ng-click="ok()">'+(s.WalletRemittance_Closed||"关闭")+"<\/button><\/div>";r.open({template:t,controller:["$scope","$modalInstance","$interval","$timeout","$window","labelService",function(n,t,i,r,u,f){var e=180,o=e,h=f.get("WalletRemittance.TimeoutClose")||"视窗将在 {0} 秒后自行关闭",s;n.ok=function(){t.close();r(function(){u.location.href="/WalletRemittance"},400)};s=i(function(){n.tip=h.replace("{0}",o);o--},1e3);r(function(){i.cancel(s);n.ok()},1e3*(e+1))}],windowClass:"qr-modal",backdrop:"static",keyboard:!1}).result.then(function(){angular.element(document.getElementById("withdrawForm").reset())})}var h=[{type:1,regx:/^[^\u4e00-\u9fa5]+$/,tip:f.get("Common.FormatTip_Chinese")||"请勿填入中文字"},{type:2,regx:/^[0-9]+$/,tip:f.get("Common.FormatTip_Number")||"格式不正确，请输入0到9之间的数字"},{type:3,regx:/(^[0-9]+$)|(\w+((-\w+)|(^\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$)/,tip:f.get("Common.FormatTip_NumberOrEmail")||"帐号格式不正确，请输入數字或Email格式"},{type:4,regx:/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/,tip:f.get("Common.FormatTip_Email")||"请输入信箱格式，例如:account@email.com"}],c,l,s;n.isEnable=!1;n.isLoading=!0;n.isSuccess=!1;n.showBankInfo=!1;n.isUpdateProcessing=!1;n.isWithdrawProcessing=!1;n.params={};n.withdrawParams={};n.confirm={};n.withdrawPlaceholder="";n.bankAccountValidate={isValid:!0,tip:""};o.getFunctionSwitch().then(function(t){(n.isEnable=t.WalletRemittanceSwitch,n.isEnable)&&v()});n.changeBankName=function(){for(var i=n.params.BankName.AccountFormat,t=0;t<h.length;t++)if(i===h[t].type){c=h[t].regx;l=h[t].tip;return}n.bankAccountValidate={isValid:!0,tip:""};n.validateAccount()};n.validateAccount=function(){angular.isDefined(n.params.Account)&&(n.bankAccountValidate.isValid=c.test(n.params.Account),n.bankAccountValidate.tip=n.bankAccountValidate.isValid?"":l)};n.updateBankAccount=function(){if(n.withdrawInfo.NoSetMoneyPassword&&n.params.MoneyPassword!==n.confirm.MoneyPassword){u.alert(s.Error_ConfirmWithdrawalPassword||"取款密码与确认密码不同");return}n.isUpdateProcessing=!0;n.params.GroupBankId=n.params.BankName.Id;t.post("/WalletRemittance/UpdateBankAccount",n.params).then(function(t){var i=t.data;if(n.isUpdateProcessing=!1,i.IsSuccess===!1){u.alertError(i.ErrorMessage);return}n.withdrawInfo.WithdrawMin=i.Min;n.withdrawInfo.WithdrawMax=i.Max;n.withdrawInfo.BankAccount=angular.extend({},n.params);n.withdrawInfo.BankAccount.BankName=n.withdrawInfo.BankAccount.BankName.Name;a(n.withdrawInfo.WithdrawMin,n.withdrawInfo.WithdrawMax);n.withdrawInfo.NoBank=!1;n.withdrawInfo.NoSetMoneyPassword=!1})};n.submitWithdraw=function(){n.isWithdrawProcessing=!0;t.post("/WalletRemittance/SubmitWithdrawApplication",n.withdrawParams).then(function(t){var i=t.data;if(n.isWithdrawProcessing=!1,i.IsSuccess===!1){u.alertError(i.ErrorMessage);return}y(i.Qrcode)})}}]);app.controller("WalletRemittanceWithdrawCtrl",["$scope","$http","$timeout","$modal","CustomModalService","languageService","FunctionSwitchService",function(n,t,i,r,u,f,e){function s(){t.post("/WalletRemittance/GetWithdrawInfo",null).then(function(t){var i=t.data;if(n.loading=!1,n.isSuccess=i.IsSuccess,n.withdrawEnabled=i.WithdrawEnabled,!i.IsSuccess){n.errorMsg=i.ErrorMessage;return}if(!i.WithdrawEnabled){n.closeMessage=i.WithdrawCloseMessage;return}n.balance=i.Balance;n.fee=i.Fee;n.adFee=i.TotalAdministration;n.TotalDiscountCancel=i.TotalDiscountCancel;n.IsPassAudit=i.IsPassAudit;n.min=i.WithdrawMin||1;n.max=i.WithdrawMax;n.condition=h(n.min,n.max);n.caculate();setTimeout(function(){$("#inputAmount").focus()})});f.getMultilingual(["WalletRemittance"]).then(function(n){o=n.data})}function h(n,t){return n!=null&&t!=null?"between":n!=null&&t==null?"more":n==null&&t!=null?"less":"unlimited"}function c(n){var t='<div class="modal-header"><h3>'+(o.WalletRemittance_WithdrawalInfo||"收款资讯")+'<\/h3><\/div><div class="modal-body"><img src="data:image/jpeg;base64,'+n+'" /><p><span ng-bind="tip"><\/span><\/p><\/div><div class="modal-footer"><button class="btn" ng-click="ok()">'+(o.WalletRemittance_Closed||"关闭")+"<\/button><\/div>";r.open({template:t,controller:["$scope","$modalInstance","$interval","$timeout","$window","labelService",function(n,t,i,r,u,f){var e=180,o=e,h=f.get("WalletRemittance.TimeoutClose")||"视窗将在 {0} 秒后自行关闭",s;n.ok=function(){t.close();r(function(){u.location.href="/WalletRemittance"},400)};s=i(function(){n.tip=h.replace("{0}",o);o--},1e3);r(function(){i.cancel(s);n.ok()},1e3*(e+1))}],windowClass:"qr-modal",backdrop:"static",keyboard:!1})}var o;n.isEnable=!1;n.loading=!0;n.isShowCalculation=!1;n.applyParams={};n.applyProcessing=!1;e.getFunctionSwitch().then(function(t){(n.isEnable=t.WalletRemittanceSwitch,n.isEnable)&&s()});n.apply=function(i){n.isOverdraft||(n.applyProcessing=!0,t.post("/WalletRemittance/SubmitWithdraw",{Amount:i.amount,WithdrawPassword:i.moneyPassword}).then(function(t){var i=t.data;if(n.applyProcessing=!1,!i.IsSuccess){u.alertError(i.ErrorMessage);return}c(i.Qrcode)}))};n.caculate=function(){var t=parseInt(n.balance)||0,i=parseInt(n.applyParams.amount)||0,r=parseInt(n.fee)||0,u=parseInt(n.adFee)||0,f=parseInt(n.TotalDiscountCancel)||0;n.isOverdraft=t-i-r-u-f<0};n.showCalculation=function(t){n.isShowCalculation=t};n.showAdministrationFeeDialog=function(){r.open({templateUrl:"/WalletRemittance/AdministrationFeeDialog",controller:"WalletAdministrationFeeDialogCtrl",windowClass:"ad-fee-dialog"})}}]);app.controller("WithdrawApplicationAdministrationFeeDialogCtrl",["$scope","$http","$window","$modalInstance",function(n,t,i,r){n.showView="loadData";t.post("/WithdrawApplication/AdministrationDetail").then(function(t){var i=t.data;n.records=i;n.records.length==0?n.showView="noData":(n.showView="getData",n.total=0,angular.forEach(i,function(t){t&&t.IsAudit===!1&&t.Amount&&(n.total+=t.Amount)}))});n.close=r.close}]);app.controller("WithdrawApplicationApplyWithdrawMethodDialogCtrl",["$scope","$http","$modalInstance","CustomModalService",function(n,t,i,r){n.applyParams={};n.submit=function(n){t.post("/WithdrawApplication/CreateAlipayAccount",n).then(function(t){if(t.data.IsSuccess===!1){r.alertError(t.data.ErrorMessage);return}r.alert("新增成功").then(function(){i.close(n)})})};n.close=function(){i.close(!1)}}]);app.controller("WithdrawApplicationCtrl",["$scope","$http","$window","$modal","CustomModalService","FunctionSwitchService",function(n,t,i,r,u,f){function e(t,i){t=t==null?n.min=1:n.min=t;i=n.max=i;n.condition=t!=null&&i!=null?"between":t!=null&&i==null?"more":t==null&&i!=null?"less":"unlimited"}function o(){var n=$(".body.container #title"),t=document.createElement("style");t.type="text/css";t.innerHTML=".custom-yuebao-color { color: "+n.css("color")+" }.custom-yuebao-bg { background-color: "+n.css("background-color")+"}.custom-yuebao-border-color { border-color:"+n.css("background-color")+"}.custom-yuebao-color-r { color: "+n.css("background-color")+" }";document.body.appendChild(t)}n.isValid=!0;n.chineseIsValid=!0;n.numberIsValid=!0;n.numberOrEmailIsValid=!0;n.emailIsValid=!0;n.confirm={MoneyPassword:""};n.loading=!0;n.isAlipayWithdrawEnable=!1;n.alipayAccount={HasAlipayAccount:!1};o();n.isYuebaoEnable=!1;f.getFunctionSwitch().then(function(t){n.isYuebaoEnable=t.YuebaoSwitch});t.post("/WithdrawApplication/Init").then(function(t){var i=t.data;if(n.loading=null,i.IsSuccess===!1){n.isSuccess=i.IsSuccess;n.errorMsg=i.ErrorMessage;return}if(i.NoBank){n.updateBankAccountParams={BankName:i.MemberBanks[0]};n.applyBankAccount=!0;n.banks=i.MemberBanks;setTimeout(function(){$("#inputBankName").focus()});i.NoSetMoneyPassword&&(n.showMoneyPassword=!0);return}n.bankAccount=i.BankAccount;n.balance=i.Balance;n.fee=i.Fee;n.adFee=i.TotalAdministration;n.TotalDiscountCancel=i.TotalDiscountCancel;n.IsPassAudit=i.IsPassAudit;n.alipayAccount=i.AlipayAccount;n.isAlipayWithdrawEnable=i.IsAlipayWithdrawEnable;n.applyParams.withdrawType=n.isAlipayWithdrawEnable&&n.alipayAccount.HasAlipayAccount?parseInt(localStorage.getItem("withdrawType"))||1:1;e(i.WithdrawMin,i.WithdrawMax);setTimeout(function(){$("#inputAmount").focus()})});n.updateBankName=function(){n.isValid=!0;n.chineseIsValid=!0;n.numberIsValid=!0;n.numberOrEmailIsValid=!0;n.emailIsValid=!0;n.updateBankAccountParams.Account=""};n.updateAccount=function(){var i=n.updateBankAccountParams.BankName.AccountFormat,t=n.updateBankAccountParams.Account;if(t!=undefined)switch(i){case 1:if(n.chineseIsValid=new RegExp(/^[^\u4e00-\u9fa5]+$/).test(t),n.chineseIsValid)n.chineseIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 2:if(n.numberIsValid=new RegExp(/^[0-9]+$/).test(t),n.numberIsValid)n.numberIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 3:if(n.numberOrEmailIsValid=new RegExp(/^[0-9]+$/).test(t),n.numberOrEmailIsValid)n.numberOrEmailIsValid=!0,n.isValid=!0;else if(n.numberOrEmailIsValid=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/).test(t),n.numberOrEmailIsValid)n.numberOrEmailIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}break;case 4:if(n.emailIsValid=new RegExp(/^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/).test(t),n.emailIsValid)n.emailIsValid=!0,n.isValid=!0;else{n.isValid=!1;return}}else n.isValid=!0,n.chineseIsValid=!0,n.numberIsValid=!0,n.numberOrEmailIsValid=!0,n.emailIsValid=!0};n.updateBankAccount=function(i){if(!i.BankName){u.alert("请填入银行名称");return}if(!i.Province){u.alert("请填入省份");return}if(!i.City){u.alert("请填入城市");return}if(!i.Account){u.alert("请填入银行帐号");return}if(n.showMoneyPassword&&i.MoneyPassword!==n.confirm.MoneyPassword){u.alert("取款密码与确认密码不同");return}if(n.bankAccount){u.alert("银行帐号已设定, 若要更改银行帐号请洽客服");return}if(!n.isValid){$("#inputAccount").focus();return}i.GroupBankId=i.BankName.Id;t.post("/WithdrawApplication/UpdateBankAccount",i).then(function(t){var r=t.data;r.IsSuccess?(n.applyBankAccount=!1,n.isAlipayWithdrawEnable=r.IsAlipayWithdrawEnable,n.showMoneyPassword=!1,n.bankAccount=i,n.bankAccount.BankName=i.BankName.Name,n.balance=r.Balance,n.fee=r.Fee,n.adFee=r.Administration,n.TotalDiscountCancel=r.DiscountCancel,n.IsPassAudit=r.IsPassAudit,e(r.Min,r.Max),setTimeout(function(){$("#inputAmount").focus()})):u.alertError(r.ErrorMessage)})};n.applyParams={withdrawType:1};n.apply=function(r){if(n.isShowApply=!0,localStorage.setItem("withdrawType",r.withdrawType),!r.amount){u.alert("请填入取款金额");return}if(n.isOverdraft()){u.alert("帐户额余不足");return}n.isAlipayWithdrawEnable||(n.applyParams.withdrawType=1);t.post("/WithdrawApplication/Apply",r).then(function(t){var r=t.data;n.isShowApply=!1;r.IsSuccess?u.alert("提款申请成功").then(function(){i.location.href="/"}):u.alertError(r.ErrorMessage)})};n.showAccount=function(){n.showBankAccount=!0};n.showCalculation=function(t){n.isShowCalculation=t};n.showMinimalAmount=function(){n.isShowMinimalAmount=!0};n.isOverdraft=function(){return n.$eval("balance - applyParams.amount - fee - adFee - TotalDiscountCancel < 0")};n.isWithdrawal=function(){return n.$eval("balance - applyParams.amount - adFee - fee - TotalDiscountCancel < min")};n.showAdministrationFeeDialog=function(){r.open({templateUrl:"/WithdrawApplication/AdministrationFeeDialog",controller:"WithdrawApplicationAdministrationFeeDialogCtrl",windowClass:"ad-fee-dialog"})};n.showApplyMethodDialog=function(){r.open({templateUrl:"/WithdrawApplication/ApplyWithdrawMethodDialog",controller:"WithdrawApplicationApplyWithdrawMethodDialogCtrl",windowClass:"apply-dialog"}).result.then(function(t){t&&(angular.extend(n.alipayAccount,t),n.alipayAccount.HasAlipayAccount=!0)})}}]);app.controller("YuebaoCtrl",["$scope","$http","$q","languageService","FunctionSwitchService",function(n,t,i,r,u){function f(){var n=$(".body.container #title"),t=document.createElement("style");t.type="text/css";t.innerHTML=".custom-yuebao-color { color: "+n.css("color")+" }.custom-yuebao-bg { background-color: "+n.css("background-color")+"}.custom-yuebao-border-color { border-color:"+n.css("background-color")+"}.custom-yuebao-color-r { color: "+n.css("background-color")+" }";document.body.appendChild(t)}function e(){document.title=n.langs.Shared_Head_Title+" - "+n.langs.Yuebao_YuebaoArea}n.isLoading=!0;n.isEnable=!1;n.langs;n.yuebaoPage="detail";f();i.all([u.getFunctionSwitch(),r.getMultilingual(["Common","Yuebao","Shared"])]).then(function(t){n.isEnable=t[0].YuebaoSwitch;n.langs=t[1].data;e();n.isLoading=!1})}]);app.controller("YuebaoDetailCtrl",["$scope","$http","$q","$modal","labelService","CustomModalService",function(n,t,i,r,u,f){function v(){n.detailPage="processing";e()}function o(t){n.processingTransfer={};h(!1,t).then(function(t){t&&(n.processingTransfer=t)})}function s(t){n.doneTransfer={};h(!0,t).then(function(t){t&&(n.doneTransfer=t)})}function h(n,r){return t.post("/Yuebao/Transfer",{IsWithdraw:n,PageIndex:r,PageSize:a}).then(function(n){var t=n.data;return t.IsSuccess===!1&&f.alertError(t.ErrorMessage).then(function(){return i.when(null)}),t.ReturnObject})}function e(){n.processingTransferSummery={};o(0);c(!1).then(function(t){t&&(n.processingTransferSummery=t)})}function y(){n.doneTransferSummery={};s(0);c(!0).then(function(t){t&&(n.doneTransferSummery=t)})}function c(n){return t.post("/Yuebao/TransferSummary",{IsWithdraw:n}).then(function(n){var t=n.data;return t.IsSuccess===!1?i.when(null):t.ReturnObject})}function l(i){t.post("/Yuebao/Withdraw",{Id:i.Id,OuterId:i.OuterId}).then(function(t){var r=t.data;if(i.isWithdrawing=!1,r.IsSuccess===!1){f.alertError(r.ErrorMessage);return}f.alert(u.get("Yuebao.WithdrawSuccess")||"赎回成功").then(function(){e();n.switchStatus("done")})})}var a=10;v();n.switchStatus=function(t){var r=[{status:"processing",callback:e},{status:"done",callback:y}],i;for(n.detailPage=t,i=0;i<r.length;i++)r[i].status===t&&r[i].callback()};n.showHistoryDialog=function(t){r.open({templateUrl:"interestHistoryModal",resolve:{item:function(){return t},langs:function(){return n.$parent.$parent.langs}},controller:["$scope","$modalInstance","item","langs",function(n,t,i,r){n.item=i;n.langs=r;n.close=function(){t.close()}}],windowClass:"yuebao-modal"})};n.withdrawCheck=function(n){if(!n.isWithdrawing&&!(n.Interest>n.LimitInterest)){if(n.isWithdrawing=!0,n.Interest===n.LimitInterest||!n.NextInterestTime){l(n);return}f.confirm(u.get("Yuebao.WithdrawConfirm")||"利息尚未结算，确定要领回吗?").then(function(t){if(!t){n.isWithdrawing=!1;return}l(n)})}};n.getProcessingTransfer=o;n.getDoneTransfer=s}]);app.controller("YuebaoPlanCtrl",["$scope","$http","$filter","labelService","CustomModalService",function(n,t,i,r,u){function f(n){return'<span class="text-danger">'+i("currency")(n.amount*(n.Rate/100))+"<\/span>"}n.isPlanLoading=!0;n.plans=[];t.post("/Yuebao/GetUserYuebaoList",null).then(function(t){n.plans=t.data.result;n.passAudit=t.data.PassAudit;n.isPlanLoading=!1});n.purchase=function(i){i.isPurchasing||!i.amount||i.amount>i.MaxAmount||i.amount<i.MinAmount||i.amount%10!=0||(i.isPurchasing=!0,t.post("/Yuebao/Deposit",{Id:i.Id,Amount:i.amount}).then(function(t){if(i.isPurchasing=!1,t.data.IsSuccess===!1){u.alertError(t.data.ErrorMessage);return}u.alert(r.get("Yuebao.PurchaseSuccess")||"購買成功！").then(function(){n.$parent.$parent.yuebaoPage="detail"})}))};n.getCycleInterestTip=function(n){var t=r.get("Yuebao.ReCycleSettle")||"每 {0} 小時利息為 {1}";return t.replace("{0}",n.SettleTime).replace("{1}",f(n))};n.getSingleInterestTip=function(n){var t=r.get("Yuebao.CycleSettle")||"{0} 小時後，利息為 {1}";return t.replace("{0}",n.SettleTime).replace("{1}",f(n))}}])